<!doctype html><html lang=en><head><meta charset=UTF-8><meta content="default-src 'self';font-src 'self' data:;img-src 'self' https://* data:;media-src 'self';style-src 'self';frame-src player.vimeo.com https://www.youtube-nocookie.com giscus.app;connect-src 'self';script-src 'self'  giscus.app 'self'" http-equiv=Content-Security-Policy><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://ogobrecht.com name=base><title>
Ottmar’s Notes • Download BLOBs with SQL*Plus</title><link href=https://ogobrecht.com/img/avatar.png rel=icon type=image/png><link title="Ottmar’s Notes - Atom Feed" href=https://ogobrecht.com/atom.xml rel=alternate type=application/atom+xml><link href="https://ogobrecht.com/custom_subset.css?h=0b9535a28bc3d5bf2321" rel=stylesheet><link href="https://ogobrecht.com/main.css?h=3716ab3457d2dd050b3c" rel=stylesheet><meta content="light dark" name=color-scheme><meta content="New version of PL/SQL Export Utilities available" name=description><meta content="New version of PL/SQL Export Utilities available" property=og:description><meta content="Download BLOBs with SQL*Plus" property=og:title><meta content=article property=og:type><meta content=en_GB property=og:locale><meta content=https://ogobrecht.com/blog/download-blobs-with-sqlplus/ property=og:url><meta content="Ottmar’s Notes" property=og:site_name><noscript><link href=https://ogobrecht.com/no_js.css rel=stylesheet></noscript><script src=https://ogobrecht.com/js/initializeTheme.min.js></script><script defer src=https://ogobrecht.com/js/themeSwitcher.min.js></script><script src="https://ogobrecht.com/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><a href=#main-content id=skip-link>Skip to content</a><header><nav class=navbar><div class=nav-title><a class=home-title href=https://ogobrecht.com/>Ottmar’s Notes</a></div><div class=nav-navs><ul><li><a class="nav-links no-hover-padding" href=https://ogobrecht.com/blog/>blog </a><li><a class="nav-links no-hover-padding" href=https://ogobrecht.com/archive/>archive </a><li><a class="nav-links no-hover-padding" href=https://ogobrecht.com/tags/>tags </a><li><a class="nav-links no-hover-padding" href=https://ogobrecht.com/projects/>projects </a><li class=menu-icons-container><ul class=menu-icons-group><li class="js menu-icon"><div aria-label="Click or press $SHORTCUT to open search" class="search-icon interactive-icon" title="Click or press $SHORTCUT to open search" id=search-button role=button tabindex=0><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z"/></svg></div><li class="theme-switcher-wrapper js"><div aria-label="Toggle dark mode" title="Toggle dark/light mode" aria-pressed=false class=theme-switcher role=button tabindex=0></div><div aria-label="Reset mode to default" class="theme-resetter arrow" title="Reset mode to default" aria-hidden=true role=button tabindex=0></div></ul></ul></div></nav></header><div class=content id=main-content><main><article class=h-entry><h1 class="p-name article-title">Download BLOBs with SQL*Plus</h1><a class="u-url u-uid" href=https://ogobrecht.com/blog/download-blobs-with-sqlplus/></a><ul class=meta><span class="hidden p-author h-card"> <a title="Ottmar Gobrecht" class=u-url href=https://ogobrecht.com rel=author>Ottmar Gobrecht</a> </span><li><time class=dt-published datetime=2020-01-01>1st Jan 2020</time><li title="447 words"><span aria-hidden=true class=separator>•</span>3 min read<li class=tag><span aria-hidden=true class=separator>•</span>Tags: <li class=tag><a class=p-category href=https://ogobrecht.com/tags/oracle/>Oracle</a>, <li class=tag><a class=p-category href=https://ogobrecht.com/tags/apex/>APEX</a>, <li class=tag><a class=p-category href=https://ogobrecht.com/tags/pl-sql/>PL/SQL</a>, <li class=tag><a class=p-category href=https://ogobrecht.com/tags/script/>Script</a>, <li class=tag><a class=p-category href=https://ogobrecht.com/tags/sql-plus/>SQL*Plus</a>, <li class=tag><a class=p-category href=https://ogobrecht.com/tags/version-control/>Version control</a></ul><p class=p-summary hidden>New version of PL/SQL Export Utilities available<section class="e-content body"><p>Have you ever tried to spool/download BLOBS with SQL*Plus? Some months ago I tried to find a way to download a collection of CLOBs or even better a zipped version of the collection as BLOB. I learned that BLOBs are not a valid datatype in SQL*Plus when it comes to the spool command. I found a way by putting the CLOBs into a global temporary table, creating an intermediate SQL script with tons of select and spool commands, and finally spooling the CLOBs one by one by calling the intermediate SQL script. It was working, but far from elegant. Also, when I was in the home office with a less powerful connection, it was slowing down the whole export process significantly.<p>If you are using PLEX (PL/SQL Export Utilities) and this sounds familiar to you - the described method was the default for exporting an APEX app or your schema DDL with the delivered export script templates.<p>If you have no idea what I am talking about: PLEX is a PL/SQL package that is able to export an Oracle APEX app, ORDS modules, all schema objects and table data into a nice directory structure in one go ready to use for version control. Check out the <a class=external href=https://github.com/ogobrecht/plex>project on GitHub</a> and this <a href=/blog/plex-plsql-export-utilities>blog post on how to get started</a>.<p>But there is a better way: Simply convert the BLOB into a base64 encoded CLOB. I have no idea why this was not my first solution for the PLEX export templates. In the new version 2.1.0 of PLEX the templates are using this approach. Here is a simplified example.<p>File export.sql:<pre class="language-sql z-code" data-lang=sql><code class=language-sql data-lang=sql><span class="z-source z-sql"><span class="z-keyword z-other z-DML z-sql">set</span> verify off feedback off heading off
</span><span class="z-source z-sql"><span class="z-keyword z-other z-DML z-sql">set</span> trimout on trimspool on pagesize <span class="z-constant z-numeric z-sql">0</span> linesize <span class="z-constant z-numeric z-sql">5000</span> long <span class="z-constant z-numeric z-sql">100000000</span> longchunksize <span class="z-constant z-numeric z-sql">32767</span>
</span><span class="z-source z-sql">whenever sqlerror exit <span class="z-constant z-other z-database-name z-sql">sql</span>.<span class="z-constant z-other z-table-name z-sql">sqlcode</span> <span class="z-keyword z-other z-LUW z-sql">rollback</span>
</span><span class="z-source z-sql">variable contents clob
</span><span class="z-source z-sql"><span class="z-keyword z-other z-LUW z-sql">begin</span>
</span><span class="z-source z-sql">  :contents :<span class="z-keyword z-operator z-comparison z-sql">=</span> <span class="z-constant z-other z-database-name z-sql">plex</span>.<span class="z-constant z-other z-table-name z-sql">to_base64</span>(<span class="z-constant z-other z-database-name z-sql">plex</span>.<span class="z-constant z-other z-table-name z-sql">to_zip</span>(<span class="z-constant z-other z-database-name z-sql">plex</span>.<span class="z-constant z-other z-table-name z-sql">backapp</span>(
</span><span class="z-source z-sql">    p_app_id               <span class="z-keyword z-operator z-comparison z-sql">=</span><span class="z-keyword z-operator z-comparison z-sql">></span> <span class="z-constant z-numeric z-sql">100</span>,
</span><span class="z-source z-sql">    p_include_ords_modules <span class="z-keyword z-operator z-comparison z-sql">=</span><span class="z-keyword z-operator z-comparison z-sql">></span> <span class="z-constant z-boolean z-sql">true</span>,
</span><span class="z-source z-sql">    p_include_object_ddl   <span class="z-keyword z-operator z-comparison z-sql">=</span><span class="z-keyword z-operator z-comparison z-sql">></span> <span class="z-constant z-boolean z-sql">false</span>,
</span><span class="z-source z-sql">    p_include_data         <span class="z-keyword z-operator z-comparison z-sql">=</span><span class="z-keyword z-operator z-comparison z-sql">></span> <span class="z-constant z-boolean z-sql">false</span>,
</span><span class="z-source z-sql">    p_include_templates    <span class="z-keyword z-operator z-comparison z-sql">=</span><span class="z-keyword z-operator z-comparison z-sql">></span> <span class="z-constant z-boolean z-sql">true</span>)));
</span><span class="z-source z-sql"><span class="z-keyword z-other z-DML z-sql">end</span>;
</span><span class="z-source z-sql"><span class="z-keyword z-operator z-math z-sql">/</span>
</span><span class="z-source z-sql"><span class="z-keyword z-other z-DML z-sql">set</span> termout off
</span><span class="z-source z-sql">spool <span class="z-string z-quoted z-double z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">"</span>app_100.zip.base64<span class="z-punctuation z-definition z-string z-end z-sql">"</span></span>
</span><span class="z-source z-sql">print contents
</span><span class="z-source z-sql">spool off
</span><span class="z-source z-sql"><span class="z-keyword z-other z-DML z-sql">set</span> termout on
</span></code></pre><p>Congratulations - You are the owner of a base64 encoded CLOB on your client disk. And now? Before you can unzip the file you need to decode it - depending on your operating system you can do this with your OS tools:<ul><li>Windows: <code>certutil -decode app_100.zip.base64 app_100.zip</code><li>Mac: <code>base64 -D -i app_100.zip.base64 -o app_100.zip</code><li>Linux: <code>base64 -d app_100.zip.base64 > app_100.zip</code></ul><p>Here a simple Windows batch file, which calls the SQL script above, decodes the file and deletes the base64 version.<p>File export.bat<pre class="language-bat z-code" data-lang=bat><code class=language-bat data-lang=bat><span class="z-source z-dosbatch"><span class="z-keyword z-command z-dosbatch">echo</span> exit <span class="z-keyword z-operator z-pipe z-dosbatch">|</span> sqlplus -S demo/oracle<span class="z-keyword z-operator z-at z-dosbatch">@</span>localhost:<span class="z-constant z-numeric z-integer z-decimal z-dosbatch">1521</span>/xepdb1 <span class="z-keyword z-operator z-at z-dosbatch">@</span>export.sql
</span><span class="z-source z-dosbatch"><span class="z-keyword z-command z-dosbatch">certutil</span> -decode app_100.zip.base64 app_100.zip
</span><span class="z-source z-dosbatch"><span class="z-keyword z-command z-dosbatch">del</span> app_100.zip.base64
</span></code></pre><p>The described method to download a BLOB is independent of the package PLEX - you only need a small helper function to encode the BLOB. I found an example provided by Tim Hall on his <a href="https://oracle-base.com/dba/script?category=miscellaneous&file=base64encode.sql" class=external>Oracle Base site</a>. Thanks for sharing Tim!<pre class="language-sql z-code" data-lang=sql><code class=language-sql data-lang=sql><span class="z-source z-sql"><span class="z-meta z-create z-sql"><span class="z-keyword z-other z-create z-sql">CREATE OR REPLACE</span> <span class="z-keyword z-other z-sql">FUNCTION</span> </span><span class="z-meta z-toc-list z-full-identifier z-sql"><span class="z-entity z-name z-function z-sql">base64encode</span></span>(p_blob <span class="z-keyword z-operator z-logical z-sql">IN</span> BLOB)
</span><span class="z-source z-sql">  RETURN CLOB
</span><span class="z-source z-sql"><span class="z-comment z-line z-double-dash z-sql"><span class="z-punctuation z-definition z-comment z-sql">--</span> -----------------------------------------------------------------------------------
</span></span><span class="z-source z-sql"><span class="z-comment z-line z-double-dash z-sql"><span class="z-punctuation z-definition z-comment z-sql">--</span> File Name    : https://oracle-base.com/dba/miscellaneous/base64encode.sql
</span></span><span class="z-source z-sql"><span class="z-comment z-line z-double-dash z-sql"><span class="z-punctuation z-definition z-comment z-sql">--</span> Author       : Tim Hall
</span></span><span class="z-source z-sql"><span class="z-comment z-line z-double-dash z-sql"><span class="z-punctuation z-definition z-comment z-sql">--</span> Description  : Encodes a BLOB into a Base64 CLOB.
</span></span><span class="z-source z-sql"><span class="z-comment z-line z-double-dash z-sql"><span class="z-punctuation z-definition z-comment z-sql">--</span> Last Modified: 09/11/2011
</span></span><span class="z-source z-sql"><span class="z-comment z-line z-double-dash z-sql"><span class="z-punctuation z-definition z-comment z-sql">--</span> -----------------------------------------------------------------------------------
</span></span><span class="z-source z-sql">IS
</span><span class="z-source z-sql">  l_clob CLOB;
</span><span class="z-source z-sql">  l_step PLS_INTEGER :<span class="z-keyword z-operator z-comparison z-sql">=</span> <span class="z-constant z-numeric z-sql">12000</span>; <span class="z-comment z-line z-double-dash z-sql"><span class="z-punctuation z-definition z-comment z-sql">--</span> make sure you set a multiple of 3 not higher than 24573
</span></span><span class="z-source z-sql"><span class="z-keyword z-other z-LUW z-sql">BEGIN</span>
</span><span class="z-source z-sql">  FOR i <span class="z-keyword z-operator z-logical z-sql">IN</span> <span class="z-constant z-numeric z-sql">0</span> .. TRUNC((<span class="z-constant z-other z-database-name z-sql">DBMS_LOB</span>.<span class="z-constant z-other z-table-name z-sql">getlength</span>(p_blob) <span class="z-keyword z-operator z-math z-sql">-</span> <span class="z-constant z-numeric z-sql">1</span> )<span class="z-keyword z-operator z-math z-sql">/</span>l_step) LOOP
</span><span class="z-source z-sql">    l_clob :<span class="z-keyword z-operator z-comparison z-sql">=</span> l_clob <span class="z-keyword z-operator z-concatenator z-sql">||</span> <span class="z-constant z-other z-database-name z-sql">UTL_RAW</span>.<span class="z-constant z-other z-table-name z-sql">cast_to_varchar2</span>(<span class="z-constant z-other z-database-name z-sql">UTL_ENCODE</span>.<span class="z-constant z-other z-table-name z-sql">base64_encode</span>(<span class="z-constant z-other z-database-name z-sql">DBMS_LOB</span>.<span class="z-constant z-other z-table-name z-sql">substr</span>(p_blob, l_step, i <span class="z-variable z-language z-star z-sql">*</span> l_step <span class="z-keyword z-operator z-math z-sql">+</span> <span class="z-constant z-numeric z-sql">1</span>)));
</span><span class="z-source z-sql">  <span class="z-keyword z-other z-DML z-sql">END</span> LOOP;
</span><span class="z-source z-sql">  RETURN l_clob;
</span><span class="z-source z-sql"><span class="z-keyword z-other z-DML z-sql">END</span>;
</span><span class="z-source z-sql"><span class="z-keyword z-operator z-math z-sql">/</span>
</span></code></pre><p>This function is included in the newest version of PLEX (named to_base64) - you can download PLEX <a class=external href=https://github.com/ogobrecht/plex/releases/latest>here</a>.<p>Happy scripting, exporting and version controlling :-)<p>Ottmar</section><nav class="full-width article-navigation"><div><a aria-describedby=left_title aria-label=Prev href=https://ogobrecht.com/blog/quick-start-version-control-for-oracle-projects/><span class=arrow>←</span> Prev</a><p aria-hidden=true id=left_title>Quick start - version control for existing Oracle projects</div><div><a aria-describedby=right_title aria-label=Next href=https://ogobrecht.com/blog/why-i-like-sqlplus-for-deployment-scripts/>Next <span class=arrow>→</span></a><p aria-hidden=true id=right_title>Why I Like SQL*Plus for Deployment Scripts</div></nav><div data-repo-id="MDEwOlJlcG9zaXRvcnkzMjEzNzI3MzE=" class=comments data-category=General data-category-id=DIC_kwDOEyfCO84C0uh1 data-dark-theme=noborder_dark data-input-position=bottom data-lang=en data-lazy-loading=true data-light-theme=noborder_light data-mapping=specific data-reactions-enabled=0 data-repo=ogobrecht/ogobrecht.com data-strict=1 data-term=download-blobs-with-sqlplus id=comments><script async src=https://ogobrecht.com/js/giscus.min.js></script><noscript>You need JavaScript to view the comments.</noscript></div></article></main><div id=button-container><a title="Go to the comments section" class=no-hover-padding href=#comments id=comments-button> <svg viewbox="0 0 20 20" fill=currentColor><path d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule=evenodd fill-rule=evenodd /></svg> </a><a title="Go to the top of the page" class=no-hover-padding href=# id=top-button> <svg viewbox="0 0 20 20" fill=currentColor><path d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z"/></svg> </a></div><span class=hidden id=copy-success> Copied! </span><span class=hidden id=copy-init> Copy code to clipboard </span><script defer src=https://ogobrecht.com/js/copyCodeToClipboard.min.js></script></div><footer><section><nav class="socials nav-navs"><ul><li><a class="nav-links no-hover-padding social" href=https://ogobrecht.com/atom.xml> <img alt=feed loading=lazy src=https://ogobrecht.com/social_icons/rss.svg title=feed> </a><li><a class="nav-links no-hover-padding social" rel=" me" href=https://github.com/ogobrecht> <img alt=GitHub loading=lazy src=https://ogobrecht.com/social_icons/github.svg title=GitHub> </a><li><a class="nav-links no-hover-padding social" rel=" me" href=https://bsky.app/profile/ogobrecht.com> <img alt=Bluesky loading=lazy src=https://ogobrecht.com/social_icons/bluesky.svg title=Bluesky> </a><li><a class="nav-links no-hover-padding social" rel=" me" href=https://www.linkedin.com/in/ogobrecht/> <img alt=LinkedIn loading=lazy src=https://ogobrecht.com/social_icons/linkedin.svg title=LinkedIn> </a><li><a class="nav-links no-hover-padding social" rel=" me" href=mailto:ottmar.gobrecht@gmail.com> <img alt=Email loading=lazy src=https://ogobrecht.com/social_icons/email.svg title=Email> </a></ul></nav><nav class=nav-navs><small> <ul><li><a class="nav-links no-hover-padding" href=https://ogobrecht.com/imprint/> imprint </a><li><a class="nav-links no-hover-padding" href=https://ogobrecht.com/privacy/> privacy policy </a><li><a class="nav-links no-hover-padding" href=https://ogobrecht.com/sitemap.xml> sitemap </a></ul> </small></nav><div class=credits><small> Powered by <a href=https://www.getzola.org>Zola</a> & <a href=https://github.com/welpo/tabi>tabi</a> </small></div></section><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><h1 class=visually-hidden id=modalTitle>Search</h1><div id=modal-content><div id=searchBar><div aria-hidden=true class=search-icon><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z"/></svg></div><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search… role=combobox spellcheck=false><div class="close-icon interactive-icon" title="Clear search" id=clear-search role=button tabindex=0><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></div></div><div id=results-container><div id=results-info><span id=zero_results> No results</span><span id=one_results> $NUMBER result</span><span id=many_results> $NUMBER results</span><span id=two_results> $NUMBER results</span><span id=few_results> $NUMBER results</span></div><div id=results role=listbox></div></div></div></div></footer>