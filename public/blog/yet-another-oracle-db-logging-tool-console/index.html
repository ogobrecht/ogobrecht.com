<!doctype html><html lang=en><head><meta charset=UTF-8><meta content="default-src 'self';font-src 'self' data:;img-src 'self' https://* data:;media-src 'self';style-src 'self';frame-src player.vimeo.com https://www.youtube-nocookie.com giscus.app;connect-src 'self';script-src 'self'  giscus.app 'self'" http-equiv=Content-Security-Policy><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://ogobrecht.com name=base><title>
Ottmar’s Notes • Yet another Oracle DB logging tool: Console</title><link href=https://ogobrecht.com/img/avatar.png rel=icon type=image/png><link title="Ottmar’s Notes - Atom Feed" href=https://ogobrecht.com/atom.xml rel=alternate type=application/atom+xml><link href="https://ogobrecht.com/custom_subset.css?h=0b9535a28bc3d5bf2321" rel=stylesheet><link href="https://ogobrecht.com/main.css?h=045c365e19a4d50a64bb" rel=stylesheet><meta content="light dark" name=color-scheme><meta content="Easy to install, works without context and special rights on administrative views, brings APEX integration with it" name=description><meta content="Easy to install, works without context and special rights on administrative views, brings APEX integration with it" property=og:description><meta content="Yet another Oracle DB logging tool: Console" property=og:title><meta content=article property=og:type><meta content=en_GB property=og:locale><meta content=https://ogobrecht.com/blog/yet-another-oracle-db-logging-tool-console/ property=og:url><meta content="Ottmar’s Notes" property=og:site_name><noscript><link href=https://ogobrecht.com/no_js.css rel=stylesheet></noscript><script src=https://ogobrecht.com/js/initializeTheme.min.js></script><script defer src=https://ogobrecht.com/js/themeSwitcher.min.js></script><script src="https://ogobrecht.com/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><a href=#main-content id=skip-link>Skip to content</a><header><nav class=navbar><div class=nav-title><a class=home-title href=https://ogobrecht.com/>Ottmar’s Notes</a></div><div class=nav-navs><ul><li><a class="nav-links no-hover-padding" href=https://ogobrecht.com/blog/>blog </a><li><a class="nav-links no-hover-padding" href=https://ogobrecht.com/archive/>archive </a><li><a class="nav-links no-hover-padding" href=https://ogobrecht.com/tags/>tags </a><li><a class="nav-links no-hover-padding" href=https://ogobrecht.com/projects/>projects </a><li class=menu-icons-container><ul class=menu-icons-group><li class="js menu-icon"><div aria-label="Click or press $SHORTCUT to open search" class="search-icon interactive-icon" title="Click or press $SHORTCUT to open search" id=search-button role=button tabindex=0><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z"/></svg></div><li class="theme-switcher-wrapper js"><div aria-label="Toggle dark mode" title="Toggle dark/light mode" aria-pressed=false class=theme-switcher role=button tabindex=0></div><div aria-label="Reset mode to default" class="theme-resetter arrow" title="Reset mode to default" aria-hidden=true role=button tabindex=0></div></ul></ul></div></nav></header><div class=content id=main-content><main><article class=h-entry><h1 class="p-name article-title">Yet another Oracle DB logging tool: Console</h1><a class="u-url u-uid" href=https://ogobrecht.com/blog/yet-another-oracle-db-logging-tool-console/></a><ul class=meta><span class="hidden p-author h-card"> <a title="Ottmar Gobrecht" class=u-url href=https://ogobrecht.com rel=author>Ottmar Gobrecht</a> </span><li><time class=dt-published datetime=2021-10-04>4th Oct 2021</time><li title="2548 words"><span aria-hidden=true class=separator>•</span>13 min read<li class=tag><span aria-hidden=true class=separator>•</span>Tags: <li class=tag><a class=p-category href=https://ogobrecht.com/tags/oracle/>Oracle</a>, <li class=tag><a class=p-category href=https://ogobrecht.com/tags/apex/>APEX</a>, <li class=tag><a class=p-category href=https://ogobrecht.com/tags/pl-sql/>PL/SQL</a>, <li class=tag><a class=p-category href=https://ogobrecht.com/tags/log/>Log</a>, <li class=tag><a class=p-category href=https://ogobrecht.com/tags/debug/>Debug</a>, <li class=tag><a class=p-category href=https://ogobrecht.com/tags/instrumentation/>Instrumentation</a></ul><p class=p-summary hidden>Easy to install, works without context and special rights on administrative views, brings APEX integration with it<section class="e-content body"><h2 id=introduction>Introduction</h2><p>It looks like it is a hobby of PL/SQL developers to develop their own logging tool. There are already some free tools on the market and probably many that have never been released (<a class=external href=https://www.doag.org/formes/pubfiles/10101682/2018-SQLPLSQL-Sabine_Heimsath-PL_SQL__Monitoren__gt__Messen__gt__Optimieren_-_mit_Open_Source-Praesentation.pdf rel=external>DOAG talk by Sabine Heimsath on the topic</a>):<ul><li><a class=external href=https://github.com/OraOpenSource/Logger rel=external>Logger</a><li><a class=external href=https://github.com/j-sieben/PIT/ rel=external>PIT</a><li><a class=external href=https://github.com/connormcd/instrumentation rel=external>Instrumentation for PLSQL</a><li><a class=external href=https://github.com/alangibson/log4plsql rel=external>Log4plsql</a><li><a class=external href=https://sourceforge.net/projects/ilo/ rel=external>ILO</a><li><a class=external href=https://sites.google.com/site/oraplsqlinst/ rel=external>BMC_DEBUG</a><li>…</ul><p>One reason seems to be that everyone has different ideas or needs. For me, I wanted a logging tool that is very easy to install and works even if you are not allowed to create a context in the database and also have no special read permissions for administrative views like v$session. You only need the rights to create tables and packages and optionally a cleanup job - pretty standard. Nevertheless, it is possible to move individual users/sessions to a higher log level for debugging purposes. As this is solved via client identifier, this will also work in an environment without fixed session ID like e.g. APEX. If no client identifier is set in an environment, then Console simply assigns one itself. Console reads its configuration from a table with only one line supported by the result cache. This ensures a resource-saving execution. Also the check whether a log message is really written to the log table based on the current log level is highly optimized to keep the overhead as low as possible in production environments.<h2 id=a-single-install-script>A single install script</h2><p>For Console, all scripts are merged into a single install script. Since SQLcl can also load scripts from the Internet, you could install the tool in a minute without downloading it first: Invoke SQLcl, log into the desired schema, and call <code>@https://raw.githubusercontent.com/ogobrecht/console/main/install/create_console_objects.sql</code>. A few seconds later you can start logging. If you want to install it in APEX and only have browser access to your development environment, the single install script in SQL Workshop is also very helpful and Console installs quickly.<h2 id=production-safe-without-further-configuration>Production safe without further configuration</h2><p>Console logs only errors (level 1) by default. This means that you are on the safe side on production systems without any further configuration. But if you want to enable other levels like warning (2), info (3), debug (4) or trace (5) on a development system and don’t want to do this for each session individually, you can set it globally: <code>exec console.conf(p_level => 3);</code>. More about this in the package description for the procedure <a class=external href=https://github.com/ogobrecht/console/blob/main/docs/package-console.md#procedure-conf rel=external>console.conf</a>.<p>To set a session (client identifier) to a higher log level use the procedure <a class=external href=https://github.com/ogobrecht/console/blob/main/docs/package-console.md#procedure-init rel=external>console.init</a>. If you omit the parameter <code>p_client_identifier</code>, then the client identifier of your own session is automatically taken - here is an example:<pre class="giallo z-code"><code data-lang=sql><span class=giallo-l><span class="z-punctuation z-definition z-comment z-comment">-- Dive into your own session with the default log level of 3 (info) and the</span></span>
<span class=giallo-l><span class="z-punctuation z-definition z-comment z-comment">-- default duration of 60 (minutes).</span></span>
<span class=giallo-l><span class=z-keyword>exec</span><span class=z-source> console.init;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span class="z-punctuation z-definition z-comment z-comment">-- With level 4 (debug) for the next 15 minutes.</span></span>
<span class=giallo-l><span class=z-keyword>exec</span><span class=z-source> console.init(</span><span class="z-constant z-numeric">4</span><span class=z-source>, </span><span class="z-constant z-numeric">15</span><span class=z-source>);</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span class="z-punctuation z-definition z-comment z-comment">-- Using a constant for the level</span></span>
<span class=giallo-l><span class=z-keyword>exec</span><span class=z-source> console.init(console.c_level_debug, </span><span class="z-constant z-numeric">90</span><span class=z-source>);</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span class="z-punctuation z-definition z-comment z-comment">-- Debug an APEX session...</span></span>
<span class=giallo-l><span class=z-keyword>begin</span></span>
<span class=giallo-l><span class=z-source>  console.init(</span></span>
<span class=giallo-l><span class=z-source>    p_client_identifier </span><span class="z-keyword z-operator">=></span><span class="z-punctuation z-definition z-string z-string"> 'OGOBRECHT:8805903776765'</span><span class=z-source>,</span></span>
<span class=giallo-l><span class=z-source>    p_level             </span><span class="z-keyword z-operator">=></span><span class=z-source> console.c_level_debug,</span></span>
<span class=giallo-l><span class=z-source>    p_duration          </span><span class="z-keyword z-operator">=></span><span class="z-constant z-numeric"> 15</span><span class=z-source>);</span></span>
<span class=giallo-l><span class="z-punctuation z-definition z-comment z-comment">    -- there are more parameters availabe...</span></span>
<span class=giallo-l><span class=z-keyword>end</span><span class=z-source>;</span></span>
<span class=giallo-l><span class="z-keyword z-operator">/</span></span></code></pre><p>Now the question arises, how to get the client identifier of a foreign session without read access to adminstrative views like e.g. v$session. A variant would be to write this for example in the frontend of an application with <code>sys_context('USERENV', 'CLIENT_IDENTIFIER')</code> - e.g. in the footer or on a help page.<p>If you want to return to the normal mode of global settings for all sessions, you can do so with <a class=external href=https://github.com/ogobrecht/console/blob/main/docs/package-console.md#procedure-exit rel=external>console.exit</a>.<p>You should not use the procedures <code>console.conf</code>, <code>init</code> and <code>exit</code> in your business logic - they are only used for managing session settings and for debugging purposes and should therefore only be used interactively or in SQL scripts.<h2 id=method-names-based-on-javascript-console>Method names based on JavaScript Console</h2><p>Console uses as many method names from the JavaScript Console as possible - so switching between backend code and frontend code shouldn’t be that hard as far as method names are concerned. Whether the methods really write anything to the log table CONSOLE_LOGS depends on the active log level - so first these:<ul><li>Level 1: Error<li>Level 2: Warning<li>Level 3: Info<li>Level 4: Debug (instead of verbose in the JavaScript Console)<li>Level 5: Trace (not available in the JavaScript Console)</ul><p>The main instrumentation methods:<ul><li>console.error_save_stack (more on that in a moment):<li>console.error (level error)<li>console.warn (level warning)<li>console.info & log (level info)<li>console.debug (level debug)<li>console.trace (level trace)<li>console.count & count_reset<li>console.count_current & count_end (level info)<li>console.count_current & count_end (function overloads, independent of log level)<li>console.time & time_reset<li>console.time_current & time_end (level info)<li>console.time_current & time_end (function overloads, independent of log level)<li>console.table# (level info)<li>console.assert & assertf<li>console.format<li>console.add_param</ul><p>More in the <a class=external href=https://github.com/ogobrecht/console/blob/main/docs/api-overview.md rel=external>API overview</a>.<h2 id=reduced-amount-of-log-entries-through-saved-call-stack>Reduced amount of log entries through saved call stack</h2><p>Console uses the capabilities of the <code>utl_call_stack</code> package to reduce the number of log entries to a possible minimum. Who doesn’t know the problem: In case of an error, a log entry is created in each sub-function to record as many details as possible. In the end you have to watch how the log table gets cluttered and you try to find out from the many log entries where exactly the error occurred.<p>It would be helpful to see the method names in the error backtrace - but the database only writes the package names and the line number in the backtrace. To work around this problem Console offers the possibility instead of writing an error in the submethods into the log table, to save the call stack with the call <code>console.error_save_stack</code> until finally in the outermost main method <code>console.error</code> is called, which then enters the error including saved call stack into the log table. For clarification, here is a script with a test package:<pre class="giallo z-code"><code data-lang=sql><span class=giallo-l><span class=z-keyword>set</span><span class=z-source> define </span><span class=z-keyword>off</span></span>
<span class=giallo-l><span class=z-keyword>set</span><span class=z-source> feedback </span><span class=z-keyword>off</span></span>
<span class=giallo-l><span class=z-keyword>set</span><span class=z-source> serveroutput </span><span class=z-keyword>on</span></span>
<span class=giallo-l><span class=z-keyword>set</span><span class=z-source> linesize </span><span class="z-constant z-numeric">120</span></span>
<span class=giallo-l><span class=z-keyword>set</span><span class=z-source> pagesize </span><span class="z-constant z-numeric">40</span></span>
<span class=giallo-l><span class=z-source>column call_stack heading </span><span class="z-punctuation z-definition z-string z-string">"Call Stack"</span><span class=z-source> format a120</span></span>
<span class=giallo-l><span class=z-source>whenever sqlerror exit sql.sqlcode</span><span class=z-keyword> rollback</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span class=z-source>prompt TEST ERROR_SAVE_STACK</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span class=z-source>prompt </span><span class="z-keyword z-operator">-</span><span class=z-source> compile package spec</span></span>
<span class=giallo-l><span class=z-keyword>create or replace</span><span class=z-source> package some_api </span><span class=z-keyword>is</span></span>
<span class=giallo-l><span class=z-keyword>  procedure</span><span class=z-source> do_stuff;</span></span>
<span class=giallo-l><span class=z-keyword>end</span><span class=z-source>;</span></span>
<span class=giallo-l><span class="z-keyword z-operator">/</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span class=z-source>prompt </span><span class="z-keyword z-operator">-</span><span class=z-source> compile package body</span></span>
<span class=giallo-l><span class=z-keyword>create or replace</span><span class=z-source> package body some_api </span><span class=z-keyword>is</span></span>
<span class=giallo-l><span class="z-punctuation z-definition z-comment z-comment">------------------------------------------------------------------------------</span></span>
<span class=giallo-l><span class=z-keyword>    procedure</span><span class=z-source> do_stuff </span><span class=z-keyword>is</span></span>
<span class=giallo-l><span class="z-punctuation z-definition z-comment z-comment">    --------------------------------------</span></span>
<span class=giallo-l><span class=z-keyword>        procedure</span><span class=z-source> sub1 </span><span class=z-keyword>is</span></span>
<span class=giallo-l><span class="z-punctuation z-definition z-comment z-comment">        --------------------------------------</span></span>
<span class=giallo-l><span class=z-keyword>            procedure</span><span class=z-source> sub2 </span><span class=z-keyword>is</span></span>
<span class=giallo-l><span class="z-punctuation z-definition z-comment z-comment">            --------------------------------------</span></span>
<span class=giallo-l><span class=z-keyword>                procedure</span><span class=z-source> sub3 </span><span class=z-keyword>is</span></span>
<span class=giallo-l><span class=z-keyword>                begin</span></span>
<span class=giallo-l><span class=z-source>                  console.assert(</span><span class="z-constant z-numeric">1</span><span class="z-keyword z-operator"> =</span><span class="z-constant z-numeric"> 2</span><span class=z-source>, </span><span class="z-punctuation z-definition z-string z-string">'Demo'</span><span class=z-source>);</span></span>
<span class=giallo-l><span class=z-source>                exception </span><span class="z-punctuation z-definition z-comment z-comment">--sub3</span></span>
<span class=giallo-l><span class=z-keyword>                  when</span><span class=z-source> others </span><span class=z-keyword>then</span></span>
<span class=giallo-l><span class=z-source>                    console.error_save_stack;</span></span>
<span class=giallo-l><span class=z-source>                    raise;</span></span>
<span class=giallo-l><span class=z-keyword>                end</span><span class=z-source>;</span></span>
<span class=giallo-l><span class="z-punctuation z-definition z-comment z-comment">            --------------------------------------</span></span>
<span class=giallo-l><span class=z-keyword>            begin</span></span>
<span class=giallo-l><span class=z-source>              sub3;</span></span>
<span class=giallo-l><span class=z-source>            exception </span><span class="z-punctuation z-definition z-comment z-comment">--sub2</span></span>
<span class=giallo-l><span class=z-keyword>              when</span><span class=z-source> others </span><span class=z-keyword>then</span></span>
<span class=giallo-l><span class=z-source>                console.error_save_stack;</span></span>
<span class=giallo-l><span class=z-source>                raise;</span></span>
<span class=giallo-l><span class=z-keyword>            end</span><span class=z-source>;</span></span>
<span class=giallo-l><span class="z-punctuation z-definition z-comment z-comment">        --------------------------------------</span></span>
<span class=giallo-l><span class=z-keyword>        begin</span></span>
<span class=giallo-l><span class=z-source>          sub2;</span></span>
<span class=giallo-l><span class=z-source>        exception </span><span class="z-punctuation z-definition z-comment z-comment">--sub1</span></span>
<span class=giallo-l><span class=z-keyword>          when</span><span class=z-source> others </span><span class=z-keyword>then</span></span>
<span class=giallo-l><span class=z-source>            console.error_save_stack;</span></span>
<span class=giallo-l><span class=z-source>            raise no_data_found;</span></span>
<span class=giallo-l><span class=z-keyword>        end</span><span class=z-source>;</span></span>
<span class=giallo-l><span class="z-punctuation z-definition z-comment z-comment">    --------------------------------------</span></span>
<span class=giallo-l><span class=z-keyword>    begin</span></span>
<span class=giallo-l><span class=z-source>      sub1;</span></span>
<span class=giallo-l><span class=z-source>    exception </span><span class="z-punctuation z-definition z-comment z-comment">--do_stuff</span></span>
<span class=giallo-l><span class=z-keyword>      when</span><span class=z-source> others </span><span class=z-keyword>then</span></span>
<span class=giallo-l><span class=z-source>        console.error;</span></span>
<span class=giallo-l><span class=z-source>        raise;</span></span>
<span class=giallo-l><span class=z-keyword>    end</span><span class=z-source>;</span></span>
<span class=giallo-l><span class="z-punctuation z-definition z-comment z-comment">------------------------------------------------------------------------------</span></span>
<span class=giallo-l><span class=z-keyword>end</span><span class=z-source>;</span></span>
<span class=giallo-l><span class="z-keyword z-operator">/</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span class=z-source>prompt </span><span class="z-keyword z-operator">-</span><span class=z-keyword> call</span><span class=z-source> the package</span></span>
<span class=giallo-l><span class=z-keyword>begin</span></span>
<span class=giallo-l><span class=z-source>  some_api.do_stuff;</span></span>
<span class=giallo-l><span class=z-source>exception</span></span>
<span class=giallo-l><span class=z-keyword>  when</span><span class=z-source> others </span><span class=z-keyword>then</span></span>
<span class=giallo-l><span class=z-keyword>    null</span><span class=z-source>; </span><span class="z-punctuation z-definition z-comment z-comment">--> I know, I know, never do that without a final raise...</span></span>
<span class=giallo-l><span class="z-punctuation z-definition z-comment z-comment">          --> But we want only test our logging without killing the script run...</span></span>
<span class=giallo-l><span class=z-keyword>end</span><span class=z-source>;</span></span>
<span class=giallo-l><span class="z-keyword z-operator">/</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span class=z-source>prompt </span><span class="z-keyword z-operator">-</span><span class=z-source> FINISHED, selecting </span><span class=z-keyword>now</span><span class=z-source> the </span><span class=z-keyword>call</span><span class=z-source> stack </span><span class=z-keyword>from</span><span class=z-source> the </span><span class=z-keyword>last log entry</span><span class=z-source>...</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span class=z-keyword>select</span><span class=z-source> call_stack </span><span class=z-keyword>from</span><span class=z-source> console_logs </span><span class=z-keyword>order by</span><span class=z-source> log_id </span><span class=z-keyword>desc fetch first row</span><span class=z-source> only;</span></span></code></pre><p>Here is the output of the above script - the Saved Error Stack section is Console’s special feature, the other three stack and trace sections are the database’s standards:<pre class="giallo z-code"><code data-lang=shellscript><span class=giallo-l><span class="z-entity z-name z-function">TEST</span><span class=z-string> ERROR_SAVE_STACK</span></span>
<span class=giallo-l><span class="z-entity z-name z-function">-</span><span class=z-string> compile package spec</span></span>
<span class=giallo-l><span class="z-entity z-name z-function">-</span><span class=z-string> compile package body</span></span>
<span class=giallo-l><span class="z-entity z-name z-function">-</span><span class=z-string> call the package</span></span>
<span class=giallo-l><span class="z-entity z-name z-function">-</span><span class=z-string> FINISHED, selecting now the call stack from the last log entry...</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span class="z-entity z-name z-function">Call</span><span class=z-string> Stack</span></span>
<span class=giallo-l><span class="z-entity z-name z-function">------------------------------------------------------------------------------------------------------------------------</span></span>
<span class=giallo-l><span class="z-punctuation z-definition z-comment z-comment">#### Saved Error Stack</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span class="z-entity z-name z-function">-</span><span class=z-string> PLAYGROUND.SOME_API.DO_STUFF.SUB1.SUB2.SUB3, line</span><span class="z-constant z-numeric"> 14</span><span class=z-source> (line</span><span class=z-string> 11, ORA-20777 Assertion failed: Demo</span><span class=z-source>)</span></span>
<span class=giallo-l><span class="z-entity z-name z-function">-</span><span class=z-string> PLAYGROUND.SOME_API.DO_STUFF.SUB1.SUB2, line</span><span class="z-constant z-numeric"> 22</span><span class=z-source> (line</span><span class="z-constant z-numeric"> 19</span><span class=z-source>)</span></span>
<span class=giallo-l><span class="z-entity z-name z-function">-</span><span class=z-string> PLAYGROUND.SOME_API.DO_STUFF.SUB1, line</span><span class="z-constant z-numeric"> 30</span><span class=z-source> (line</span><span class="z-constant z-numeric"> 27</span><span class=z-source>)</span></span>
<span class=giallo-l><span class="z-entity z-name z-function">-</span><span class=z-string> PLAYGROUND.SOME_API.DO_STUFF, line</span><span class="z-constant z-numeric"> 38</span><span class=z-source> (line</span><span class=z-string> 35, ORA-01403 no data found</span><span class=z-source>)</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span class="z-punctuation z-definition z-comment z-comment">#### Call Stack</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span class="z-entity z-name z-function">-</span><span class=z-string> PLAYGROUND.SOME_API.DO_STUFF, line</span><span class="z-constant z-numeric"> 38</span></span>
<span class=giallo-l><span class="z-entity z-name z-function">-</span><span class=z-string> __anonymous_block, line</span><span class="z-constant z-numeric"> 2</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span class="z-punctuation z-definition z-comment z-comment">#### Error Stack</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span class="z-entity z-name z-function">-</span><span class=z-string> ORA-01403 no data found</span></span>
<span class=giallo-l><span class="z-entity z-name z-function">-</span><span class="z-string z-punctuation z-definition z-string"> ORA-06512 at "PLAYGROUND.SOME_API", line</span><span class="z-constant z-numeric"> 31</span></span>
<span class=giallo-l><span class="z-entity z-name z-function">-</span><span class=z-string> ORA-20777 Assertion failed: Test assertion with line break.</span></span>
<span class=giallo-l><span class="z-entity z-name z-function">-</span><span class="z-string z-punctuation z-definition z-string"> ORA-06512 at "PLAYGROUND.SOME_API", line</span><span class="z-constant z-numeric"> 23</span></span>
<span class=giallo-l><span class="z-entity z-name z-function">-</span><span class="z-string z-punctuation z-definition z-string"> ORA-06512 at "PLAYGROUND.SOME_API", line</span><span class="z-constant z-numeric"> 15</span></span>
<span class=giallo-l><span class="z-entity z-name z-function">-</span><span class="z-string z-punctuation z-definition z-string"> ORA-06512 at "PLAYGROUND.CONSOLE", line</span><span class="z-constant z-numeric"> 750</span></span>
<span class=giallo-l><span class="z-entity z-name z-function">-</span><span class="z-string z-punctuation z-definition z-string"> ORA-06512 at "PLAYGROUND.SOME_API", line</span><span class="z-constant z-numeric"> 11</span></span>
<span class=giallo-l><span class="z-entity z-name z-function">-</span><span class="z-string z-punctuation z-definition z-string"> ORA-06512 at "PLAYGROUND.SOME_API", line</span><span class="z-constant z-numeric"> 19</span></span>
<span class=giallo-l><span class="z-entity z-name z-function">-</span><span class="z-string z-punctuation z-definition z-string"> ORA-06512 at "PLAYGROUND.SOME_API", line</span><span class="z-constant z-numeric"> 27</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span class="z-punctuation z-definition z-comment z-comment">#### Error Backtrace</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span class="z-entity z-name z-function">-</span><span class=z-string> PLAYGROUND.SOME_API, line</span><span class="z-constant z-numeric"> 31</span></span>
<span class=giallo-l><span class="z-entity z-name z-function">-</span><span class=z-string> PLAYGROUND.SOME_API, line</span><span class="z-constant z-numeric"> 23</span></span>
<span class=giallo-l><span class="z-entity z-name z-function">-</span><span class=z-string> PLAYGROUND.SOME_API, line</span><span class="z-constant z-numeric"> 15</span></span>
<span class=giallo-l><span class="z-entity z-name z-function">-</span><span class=z-string> PLAYGROUND.CONSOLE, line</span><span class="z-constant z-numeric"> 750</span></span>
<span class=giallo-l><span class="z-entity z-name z-function">-</span><span class=z-string> PLAYGROUND.SOME_API, line</span><span class="z-constant z-numeric"> 11</span></span>
<span class=giallo-l><span class="z-entity z-name z-function">-</span><span class=z-string> PLAYGROUND.SOME_API, line</span><span class="z-constant z-numeric"> 19</span></span>
<span class=giallo-l><span class="z-entity z-name z-function">-</span><span class=z-string> PLAYGROUND.SOME_API, line</span><span class="z-constant z-numeric"> 27</span></span>
<span class=giallo-l><span class="z-entity z-name z-function">-</span><span class=z-string> PLAYGROUND.SOME_API, line</span><span class="z-constant z-numeric"> 35</span></span></code></pre><p>If you don’t use <code>console.error_save_stack</code> but always <code>console.error</code>, then you get at least the last three sections in the log - and without extra work in the code. You just have to remember <code>console.error</code>.<h2 id=simple-logging-of-method-parameters>Simple logging of method parameters</h2><p>Console also provides a simple way to log method parameters. Here is a sample procedure with parameters of all supported types:<pre class="giallo z-code"><code data-lang=sql><span class=giallo-l><span class="z-punctuation z-definition z-comment z-comment">--create demo procedure</span></span>
<span class=giallo-l><span class=z-keyword>create or replace procedure</span><span class=z-source> demo_proc(</span></span>
<span class=giallo-l><span class=z-source>  p_01 </span><span class="z-storage z-type">varchar2</span><span class=z-source>,</span></span>
<span class=giallo-l><span class=z-source>  p_02 </span><span class="z-storage z-type">number</span><span class=z-source>,</span></span>
<span class=giallo-l><span class=z-source>  p_03 </span><span class="z-storage z-type">date</span><span class=z-source>,</span></span>
<span class=giallo-l><span class=z-source>  p_04 </span><span class="z-storage z-type">timestamp</span><span class=z-source>,</span></span>
<span class=giallo-l><span class=z-source>  p_05 </span><span class="z-storage z-type">timestamp with time zone</span><span class=z-source>,</span></span>
<span class=giallo-l><span class=z-source>  p_06 </span><span class="z-storage z-type z-keyword">timestamp with local time zone</span><span class=z-source>,</span></span>
<span class=giallo-l><span class=z-source>  p_07 interval </span><span class=z-keyword>year to month</span><span class=z-source>,</span></span>
<span class=giallo-l><span class=z-source>  p_08 interval </span><span class=z-keyword>day to second</span><span class=z-source>,</span></span>
<span class=giallo-l><span class=z-source>  p_09 </span><span class="z-storage z-type">boolean</span><span class=z-source>,</span></span>
<span class=giallo-l><span class=z-source>  p_10 clob,</span></span>
<span class=giallo-l><span class=z-source>  p_11 xmltype)</span></span>
<span class=giallo-l><span class=z-keyword>is</span></span>
<span class=giallo-l><span class=z-keyword>begin</span></span>
<span class=giallo-l><span class=z-source>  raise_application_error(</span><span class="z-keyword z-operator">-</span><span class="z-constant z-numeric">20999</span><span class=z-source>, </span><span class="z-punctuation z-definition z-string z-string">'Test Error.'</span><span class=z-source>);</span></span>
<span class=giallo-l><span class=z-source>exception</span></span>
<span class=giallo-l><span class=z-keyword>  when</span><span class=z-source> others </span><span class=z-keyword>then</span></span>
<span class=giallo-l><span class=z-source>    console.add_param(</span><span class="z-punctuation z-definition z-string z-string">'p_01'</span><span class=z-source>, p_01);</span></span>
<span class=giallo-l><span class=z-source>    console.add_param(</span><span class="z-punctuation z-definition z-string z-string">'p_02'</span><span class=z-source>, p_02);</span></span>
<span class=giallo-l><span class=z-source>    console.add_param(</span><span class="z-punctuation z-definition z-string z-string">'p_03'</span><span class=z-source>, p_03);</span></span>
<span class=giallo-l><span class=z-source>    console.add_param(</span><span class="z-punctuation z-definition z-string z-string">'p_04'</span><span class=z-source>, p_04);</span></span>
<span class=giallo-l><span class=z-source>    console.add_param(</span><span class="z-punctuation z-definition z-string z-string">'p_05'</span><span class=z-source>, p_05);</span></span>
<span class=giallo-l><span class=z-source>    console.add_param(</span><span class="z-punctuation z-definition z-string z-string">'p_06'</span><span class=z-source>, p_06);</span></span>
<span class=giallo-l><span class=z-source>    console.add_param(</span><span class="z-punctuation z-definition z-string z-string">'p_07'</span><span class=z-source>, p_07);</span></span>
<span class=giallo-l><span class=z-source>    console.add_param(</span><span class="z-punctuation z-definition z-string z-string">'p_08'</span><span class=z-source>, p_08);</span></span>
<span class=giallo-l><span class=z-source>    console.add_param(</span><span class="z-punctuation z-definition z-string z-string">'p_09'</span><span class=z-source>, p_09);</span></span>
<span class=giallo-l><span class=z-source>    console.add_param(</span><span class="z-punctuation z-definition z-string z-string">'p_10'</span><span class=z-source>, p_10);</span></span>
<span class=giallo-l><span class=z-source>    console.add_param(</span><span class="z-punctuation z-definition z-string z-string">'p_11'</span><span class=z-source>, p_11);</span></span>
<span class=giallo-l><span class=z-source>    console.error(</span><span class="z-punctuation z-definition z-string z-string">'Ooops, something went wrong'</span><span class=z-source>);</span></span>
<span class=giallo-l><span class=z-source>    raise;</span></span>
<span class=giallo-l><span class=z-keyword>end</span><span class=z-source> demo_proc;</span></span>
<span class=giallo-l><span class="z-keyword z-operator">/</span></span></code></pre><p>In the exception handling you can see nicely that you always call the same procedure <code>console.add_param</code> and pass the name and the value. The parameters are cached in an array in the console package (shortened to a maximum of 2000 characters) and taken over with the next call of a log method (error, warn, info, log, debug or trace). If you don’t want the parameters to be truncated, you are free to write the parameter directly into the log message - this is of type clob and is therefore not subject to any size restrictions.<p>Here an example call of the above procedure:<pre class="giallo z-code"><code data-lang=sql><span class=giallo-l><span class=z-keyword>begin</span></span>
<span class=giallo-l><span class=z-source>  demo_proc(</span></span>
<span class=giallo-l><span class=z-source>    p_01 </span><span class="z-keyword z-operator">=></span><span class="z-punctuation z-definition z-string z-string"> 'test vc2'</span><span class=z-source>,</span></span>
<span class=giallo-l><span class=z-source>    p_02 </span><span class="z-keyword z-operator">=></span><span class="z-constant z-numeric"> 1</span><span class=z-source>.</span><span class="z-constant z-numeric">23</span><span class=z-source>,</span></span>
<span class=giallo-l><span class=z-source>    p_03 </span><span class="z-keyword z-operator">=></span><span class="z-storage z-type"> sysdate</span><span class=z-source>,</span></span>
<span class=giallo-l><span class=z-source>    p_04 </span><span class="z-keyword z-operator">=></span><span class=z-source> systimestamp,</span></span>
<span class=giallo-l><span class=z-source>    p_05 </span><span class="z-keyword z-operator">=></span><span class=z-source> systimestamp,</span></span>
<span class=giallo-l><span class=z-source>    p_06 </span><span class="z-keyword z-operator">=></span><span class=z-source> localtimestamp,</span></span>
<span class=giallo-l><span class=z-source>    p_07 </span><span class="z-keyword z-operator">=></span><span class=z-source> interval </span><span class="z-punctuation z-definition z-string z-string">'4-2'</span><span class=z-keyword> year to month</span><span class=z-source>,</span></span>
<span class=giallo-l><span class=z-source>    p_08 </span><span class="z-keyword z-operator">=></span><span class=z-source> interval </span><span class="z-punctuation z-definition z-string z-string">'7 6:12:42.123'</span><span class=z-keyword> day to second</span><span class=z-source>,</span></span>
<span class=giallo-l><span class=z-source>    p_09 </span><span class="z-keyword z-operator">=></span><span class=z-source> true,</span></span>
<span class=giallo-l><span class=z-source>    p_10 </span><span class="z-keyword z-operator">=></span><span class=z-source> to_clob(</span><span class="z-punctuation z-definition z-string z-string">'test clob'</span><span class=z-source>),</span></span>
<span class=giallo-l><span class=z-source>    p_11 </span><span class="z-keyword z-operator">=></span><span class=z-source> xmltype(</span><span class="z-punctuation z-definition z-string z-string">'&lt;test_xml/>'</span><span class=z-source>));</span></span>
<span class=giallo-l><span class=z-keyword>end</span><span class=z-source>;</span></span>
<span class=giallo-l><span class="z-keyword z-operator">/</span></span></code></pre><p>This call then writes the following log message - see the MESSAGE column:<p><img alt="example log entry" src=/img/console-logs-single-record.png><h2 id=markdown-format-for-automatically-determined-metadata>Markdown format for automatically determined metadata</h2><p>The attentive reader might not have missed that the above log message is formatted in Markdown. So, if you like, you can have your report rendered accordingly in HTML (e.g. in APEX) - however, it is well readable in text form, too. The Markdown table format as in the example above is also used by Console for logging other metadata such as APEX environment, CGI environment, user environment and console environment. All of these environments can be turned on for each individual log call. They are then appended to the log message like the parameters. Here exemplarily the signature of the error procedure:<pre class="giallo z-code"><code data-lang=sql><span class=giallo-l><span class=z-keyword>procedure</span><span class=z-source> error(</span></span>
<span class=giallo-l><span class=z-source>  p_message         </span><span class=z-keyword>in</span><span class=z-source> clob     </span><span class="z-storage z-modifier z-keyword">default null</span><span class=z-source>,  </span><span class="z-punctuation z-definition z-comment z-comment">-- The log message itself</span></span>
<span class=giallo-l><span class=z-source>  p_permanent       </span><span class="z-keyword z-storage z-type z-storage z-modifier">in boolean  default</span><span class=z-source> false, </span><span class="z-punctuation z-definition z-comment z-comment">-- Should the log entry be permanent (not deleted by purge methods)</span></span>
<span class=giallo-l><span class=z-source>  p_call_stack      </span><span class="z-keyword z-storage z-type z-storage z-modifier">in boolean  default</span><span class=z-source> true,  </span><span class="z-punctuation z-definition z-comment z-comment">-- Include call stack</span></span>
<span class=giallo-l><span class=z-source>  p_apex_env        </span><span class="z-keyword z-storage z-type z-storage z-modifier">in boolean  default</span><span class=z-source> false, </span><span class="z-punctuation z-definition z-comment z-comment">-- Include APEX environment</span></span>
<span class=giallo-l><span class=z-source>  p_cgi_env         </span><span class="z-keyword z-storage z-type z-storage z-modifier">in boolean  default</span><span class=z-source> false, </span><span class="z-punctuation z-definition z-comment z-comment">-- Include CGI environment</span></span>
<span class=giallo-l><span class=z-source>  p_console_env     </span><span class="z-keyword z-storage z-type z-storage z-modifier">in boolean  default</span><span class=z-source> false, </span><span class="z-punctuation z-definition z-comment z-comment">-- Include Console environment</span></span>
<span class=giallo-l><span class=z-source>  p_user_env        </span><span class="z-keyword z-storage z-type z-storage z-modifier">in boolean  default</span><span class=z-source> false, </span><span class="z-punctuation z-definition z-comment z-comment">-- Include user environment</span></span>
<span class=giallo-l><span class=z-source>  p_user_agent      </span><span class="z-keyword z-storage z-type z-storage z-modifier">in varchar2 default null</span><span class=z-source>,  </span><span class="z-punctuation z-definition z-comment z-comment">-- User agent of browser or other client technology</span></span>
<span class=giallo-l><span class=z-source>  p_user_scope      </span><span class="z-keyword z-storage z-type z-storage z-modifier">in varchar2 default null</span><span class=z-source>,  </span><span class="z-punctuation z-definition z-comment z-comment">-- Override PL/SQL scope</span></span>
<span class=giallo-l><span class=z-source>  p_user_error_code </span><span class="z-keyword z-storage z-type z-storage z-modifier">in integer  default null</span><span class=z-source>,  </span><span class="z-punctuation z-definition z-comment z-comment">-- Override PL/SQL error code</span></span>
<span class=giallo-l><span class=z-source>  p_user_call_stack </span><span class="z-keyword z-storage z-type z-storage z-modifier">in varchar2 default null</span><span class=z-source>); </span><span class="z-punctuation z-definition z-comment z-comment">-- Override PL/SQL call stack</span></span></code></pre><h2 id=extensible-logs-through-overloaded-log-methods>Extensible logs through overloaded log methods</h2><p>The error procedure has an overload in the form of a function that returns the log ID. Thus one can extend the logging also with own data in own tables e.g. for a downstream release process in case of specific errors. This is also the purpose of the <code>p_permanent</code> parameter, which ensures that the cleanup job or the <code>console.purge</code> and <code>console.purge_all</code> procedures do not delete the correspondingly marked log entries and that these are permanently available. All other log methods (warn, info, log, debug, trace) are implemented in the same way and with the same parameters - but some have different default values. For the error method the call stack is written, for the trace method all four environment details.<p>The parameters <code>p_user_agent</code>, <code>p_user_scope</code>, <code>p_user_error_code</code> and <code>p_user_call_stack</code> are intended to be able to capture external log events as well and to overwrite the automatically determined values of the PL/SQL environment. As an example an external load process in a data warehouse or error messages from the JavaScript frontend of an application can be mentioned. With a little imagination, everyone will come up with their own use cases here…<h2 id=measure-time-and-count-things>Measure time and count things</h2><p>Measuring execution times and counting things are very common functions. Console can help here to not have to create too many helper variables and keep the code short and sweet. For this purpose it offers the procedures <code>time</code>, <code>count</code> and other helpers. You can easily run several timers or counters in parallel - they are each identified by an optional label. If you omit the label, then internally the label is <code>default</code>. The best way to illustrate this is a bit of sample code:<pre class="giallo z-code"><code data-lang=sql><span class=giallo-l><span class=z-keyword>begin</span></span>
<span class=giallo-l><span class="z-punctuation z-definition z-comment z-comment">  --basic usage</span></span>
<span class=giallo-l><span class=z-source>  console.time;</span></span>
<span class=giallo-l><span class=z-source>  sys.dbms_session.sleep(</span><span class="z-constant z-numeric">0</span><span class=z-source>.</span><span class="z-constant z-numeric">1</span><span class=z-source>);</span></span>
<span class=giallo-l><span class=z-source>  console.time_end; </span><span class="z-punctuation z-definition z-comment z-comment">-- without optional label and message</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span class=z-source>  console.time(</span><span class="z-punctuation z-definition z-string z-string">'myTimer'</span><span class=z-source>);</span></span>
<span class=giallo-l><span class=z-source>  sys.dbms_session.sleep(</span><span class="z-constant z-numeric">0</span><span class=z-source>.</span><span class="z-constant z-numeric">1</span><span class=z-source>);</span></span>
<span class=giallo-l><span class=z-source>  console.time_current(</span><span class="z-punctuation z-definition z-string z-string">'myTimer'</span><span class=z-source>); </span><span class="z-punctuation z-definition z-comment z-comment">-- without optional message</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span class=z-source>  sys.dbms_session.sleep(</span><span class="z-constant z-numeric">0</span><span class=z-source>.</span><span class="z-constant z-numeric">1</span><span class=z-source>);</span></span>
<span class=giallo-l><span class=z-source>  console.time_current(</span><span class="z-punctuation z-definition z-string z-string">'myTimer'</span><span class=z-source>, </span><span class="z-punctuation z-definition z-string z-string">'end of step two'</span><span class=z-source>);</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span class=z-source>  sys.dbms_session.sleep(</span><span class="z-constant z-numeric">0</span><span class=z-source>.</span><span class="z-constant z-numeric">1</span><span class=z-source>);</span></span>
<span class=giallo-l><span class=z-source>  console.time_end(</span><span class="z-punctuation z-definition z-string z-string">'myTimer'</span><span class=z-source>, </span><span class="z-punctuation z-definition z-string z-string">'end of step three'</span><span class=z-source>);</span></span>
<span class=giallo-l><span class=z-keyword>end</span><span class=z-source>;</span></span>
<span class=giallo-l><span class="z-keyword z-operator">/</span></span></code></pre><p>This will result in the following log messages in the console_logs table if the current log level is 3 (info) or higher:<ul><li>default: 00:00:00.102508<li>myTimer: 00:00:00.108048<li>myTimer: 00:00:00.212045 - end of step two<li>myTimer: 00:00:00.316084 - end of step three</ul><p>But sometimes you don’t want to have prefabricated log entries or you need the elapsed time to write them in scripts to the server output. For this purpose the procedures <code>time_current</code> and <code>time_end</code> used in the code are also available as overloaded functions. With these you can do what you want:<pre class="giallo z-code"><code data-lang=sql><span class=giallo-l><span class=z-keyword>set</span><span class=z-source> serveroutput </span><span class=z-keyword>on</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span class=z-keyword>begin</span></span>
<span class=giallo-l><span class=z-source>  console.time;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span class="z-punctuation z-definition z-comment z-comment">  --console.print is an alias for sys.dbms_output.put_line</span></span>
<span class=giallo-l><span class=z-source>  console.print(</span><span class="z-punctuation z-definition z-string z-string">'Processing step one...'</span><span class=z-source>);</span></span>
<span class=giallo-l><span class=z-source>  sys.dbms_session.sleep(</span><span class="z-constant z-numeric">0</span><span class=z-source>.</span><span class="z-constant z-numeric">1</span><span class=z-source>);</span></span>
<span class=giallo-l><span class=z-source>  console.print(</span><span class="z-punctuation z-definition z-string z-string">'Elapsed: '</span><span class="z-keyword z-operator"> ||</span><span class=z-source> console.time_current);</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span class=z-source>  console.print(</span><span class="z-punctuation z-definition z-string z-string">'Processing step two...'</span><span class=z-source>);</span></span>
<span class=giallo-l><span class=z-source>  sys.dbms_session.sleep(</span><span class="z-constant z-numeric">0</span><span class=z-source>.</span><span class="z-constant z-numeric">1</span><span class=z-source>);</span></span>
<span class=giallo-l><span class=z-source>  console.print(</span><span class="z-punctuation z-definition z-string z-string">'Elapsed: '</span><span class="z-keyword z-operator"> ||</span><span class=z-source> console.time_current);</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span class=z-source>  console.print(</span><span class="z-punctuation z-definition z-string z-string">'Processing step three...'</span><span class=z-source>);</span></span>
<span class=giallo-l><span class=z-source>  sys.dbms_session.sleep(</span><span class="z-constant z-numeric">0</span><span class=z-source>.</span><span class="z-constant z-numeric">1</span><span class=z-source>);</span></span>
<span class=giallo-l><span class=z-source>  console.print(</span><span class="z-punctuation z-definition z-string z-string">'Elapsed: '</span><span class="z-keyword z-operator"> ||</span><span class=z-source> console.time_end);</span></span>
<span class=giallo-l><span class=z-keyword>end</span><span class=z-source>;</span></span>
<span class=giallo-l><span class="z-keyword z-operator">/</span></span></code></pre><p>This then leads to something like this server output:<pre class="giallo z-code"><code data-lang=shellscript><span class=giallo-l><span class="z-entity z-name z-function">Processing</span><span class=z-string> step one...</span></span>
<span class=giallo-l><span class="z-entity z-name z-function">Elapsed:</span><span class=z-string> 00:00:00.105398</span></span>
<span class=giallo-l><span class="z-entity z-name z-function">Processing</span><span class=z-string> step two...</span></span>
<span class=giallo-l><span class="z-entity z-name z-function">Elapsed:</span><span class=z-string> 00:00:00.209267</span></span>
<span class=giallo-l><span class="z-entity z-name z-function">Processing</span><span class=z-string> step three...</span></span>
<span class=giallo-l><span class="z-entity z-name z-function">Elapsed:</span><span class=z-string> 00:00:00.313301</span></span></code></pre><p>For counting things or processes there are the same procedures and functions as for time measurements - only with the prefix <code>count</code> instead of <code>time</code> (we use the variant without label in the example):<pre class="giallo z-code"><code data-lang=sql><span class=giallo-l><span class=z-keyword>set</span><span class=z-source> serveroutput </span><span class=z-keyword>on</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span class=z-keyword>begin</span></span>
<span class=giallo-l><span class=z-source>  console.print(</span><span class="z-punctuation z-definition z-string z-string">'Counting nonsense...'</span><span class=z-source>);</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span class=z-keyword>  for</span><span class=z-source> i </span><span class=z-keyword>in</span><span class="z-constant z-numeric"> 1</span><span class=z-source> .. </span><span class="z-constant z-numeric">1000</span><span class=z-keyword> loop</span></span>
<span class=giallo-l><span class=z-keyword>    if</span><span class=z-source> mod(i, </span><span class="z-constant z-numeric">3</span><span class=z-source>) </span><span class="z-keyword z-operator">=</span><span class="z-constant z-numeric"> 0</span><span class=z-keyword> then</span></span>
<span class=giallo-l><span class=z-source>      console.count;</span></span>
<span class=giallo-l><span class=z-keyword>    end if</span><span class=z-source>;</span></span>
<span class=giallo-l><span class=z-keyword>  end loop</span><span class=z-source>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span class=z-source>  console.print(</span><span class="z-punctuation z-definition z-string z-string">'Current value: '</span><span class="z-keyword z-operator"> ||</span><span class=z-source> console.count_current );</span></span>
<span class=giallo-l><span class=z-source>  console.count_reset;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span class=z-keyword>  for</span><span class=z-source> i </span><span class=z-keyword>in</span><span class="z-constant z-numeric"> 1</span><span class=z-source> .. </span><span class="z-constant z-numeric">10</span><span class=z-keyword> loop</span></span>
<span class=giallo-l><span class=z-source>    console.count;</span></span>
<span class=giallo-l><span class=z-keyword>  end loop</span><span class=z-source>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span class=z-source>  console.print(</span><span class="z-punctuation z-definition z-string z-string">'Final value: '</span><span class="z-keyword z-operator"> ||</span><span class=z-source> console.count_end );</span></span>
<span class=giallo-l><span class=z-keyword>end</span><span class=z-source>;</span></span>
<span class=giallo-l><span class="z-keyword z-operator">/</span></span></code></pre><p>This then results in a server output as follows:<pre class="giallo z-code"><code data-lang=shellscript><span class=giallo-l><span class="z-entity z-name z-function">Counting</span><span class=z-string> nonsense...</span></span>
<span class=giallo-l><span class="z-entity z-name z-function">Current</span><span class=z-string> value:</span><span class="z-constant z-numeric"> 333</span></span>
<span class=giallo-l><span class="z-entity z-name z-function">Final</span><span class=z-string> value:</span><span class="z-constant z-numeric"> 10</span></span></code></pre><p>The <code>count_reset</code> procedure used in the example also exists for timers and is called <code>time_reset</code> there. The respective <code>*_end</code> methods delete the entry from the list of timers/counters managed in the console package.<h2 id=assert-format-and-other-helpers>Assert, format and other helpers</h2><p>There are other auxiliary methods that make the developer’s life more pleasant. First of all, the assert procedure should be mentioned. Everyone should know this recurring pattern:<pre class="giallo z-code"><code data-lang=sql><span class=giallo-l><span class=z-keyword>if not</span><span class=z-source> x </span><span class="z-keyword z-operator">&lt;</span><span class=z-source> y </span><span class=z-keyword>then</span></span>
<span class=giallo-l><span class=z-source>  raise_application_error(</span><span class="z-keyword z-operator">-</span><span class="z-constant z-numeric">20999</span><span class=z-source>, </span><span class="z-punctuation z-definition z-string z-string">'X should be less than Y'</span><span class=z-source>);</span></span>
<span class=giallo-l><span class=z-keyword>else</span></span>
<span class=giallo-l><span class="z-punctuation z-definition z-comment z-comment">  -- your code here</span></span>
<span class=giallo-l><span class=z-keyword>end if</span><span class=z-source>;</span></span></code></pre><p>It gets especially ugly when you have to check multiple conditions. The whole thing can also be formulated as a one-liner:<pre class="giallo z-code"><code data-lang=sql><span class=giallo-l><span class=z-source>console.assert(x </span><span class="z-keyword z-operator">&lt;</span><span class=z-source> y, </span><span class="z-punctuation z-definition z-string z-string">'x should be less then y'</span><span class=z-source>);</span></span></code></pre><p>If you want to enrich texts with dynamic information, then you are quickly in concatenation hell:<pre class="giallo z-code"><code data-lang=sql><span class=giallo-l><span class=z-source>console.assert(</span></span>
<span class=giallo-l><span class=z-source>  x </span><span class="z-keyword z-operator">&lt;</span><span class=z-source> y,</span></span>
<span class=giallo-l><span class="z-punctuation z-definition z-string z-string">  'x should be less then y (x='</span></span>
<span class=giallo-l><span class="z-keyword z-operator">  ||</span><span class=z-source> to_char(x)</span></span>
<span class=giallo-l><span class="z-keyword z-operator">  ||</span><span class="z-punctuation z-definition z-string z-string"> ', y='</span></span>
<span class=giallo-l><span class="z-keyword z-operator">  ||</span><span class=z-source> to_char(y)</span></span>
<span class=giallo-l><span class="z-keyword z-operator">  ||</span><span class="z-punctuation z-definition z-string z-string"> ')'</span><span class=z-source>);</span></span></code></pre><p>Here the <code>format</code> function can help you:<pre class="giallo z-code"><code data-lang=sql><span class=giallo-l><span class=z-source>console.assert(</span></span>
<span class=giallo-l><span class=z-source>  x </span><span class="z-keyword z-operator">&lt;</span><span class=z-source> y,</span></span>
<span class=giallo-l><span class=z-source>  console.format(</span></span>
<span class=giallo-l><span class="z-punctuation z-definition z-string z-string">    'x should be less then y (x=%s, y=%s)'</span><span class=z-source>,</span></span>
<span class=giallo-l><span class=z-source>    to_char(x),</span></span>
<span class=giallo-l><span class=z-source>    to_char(y)));</span></span></code></pre><p><code>format</code> accepts up to 10 parameters and works according to the following rules:<ol><li>replace all occurrences of <code>%0</code> … <code>%9</code> with the corresponding parameters <code>p0</code> … <code>p9</code><li>replace <code>%n</code> with new lines (line feed character)<li>replace all occurrences of <code>%s</code> in positional order with the corresponding parameters with sys.utl_lms.format_message - see also the <a class=external href=https://docs.oracle.com/en/database/oracle/oracle-database/19/arpls/UTL_LMS.html#GUID-88FFBFB6-FCA4-4951-884B-B0275BD5DF44 rel=external>Oracle docs</a></ol><p>I personally am very reluctant to type <code>sys.dbms_output.put_line</code>. Console does write to a log table with all the log methods, but actually the word console suggests that we can also write directly to the server output, right? For that we have the procedure <code>print</code>:<pre class="giallo z-code"><code data-lang=sql><span class=giallo-l><span class=z-source>console.print(</span><span class="z-punctuation z-definition z-string z-string">'A message'</span><span class=z-source>);</span></span></code></pre><p>Then there are the short forms of <code>console.print(console.format(...))</code> and <code>console.assert([boolean expression], console.format(...))</code>:<pre class="giallo z-code"><code data-lang=sql><span class=giallo-l><span class=z-source>console.printf(</span></span>
<span class=giallo-l><span class="z-punctuation z-definition z-string z-string">  'A dynamic message with a %n second line of text: %s'</span><span class=z-source>,</span></span>
<span class=giallo-l><span class=z-source>  my_var);</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span class=z-source>console.assertf(</span></span>
<span class=giallo-l><span class=z-source>  x </span><span class="z-keyword z-operator">&lt;</span><span class=z-source> y,</span></span>
<span class=giallo-l><span class="z-punctuation z-definition z-string z-string">  'x should be less then y (x=%s, y=%s)'</span><span class=z-source>,</span></span>
<span class=giallo-l><span class=z-source>  to_char(x),</span></span>
<span class=giallo-l><span class=z-source>  to_char(y));</span></span></code></pre><p>Also often needed is a fast, cached clob concatenation - that’s where Console can help with <a class=external href=https://github.com/ogobrecht/console/blob/main/docs/package-console.md#procedure-clob_append rel=external>clob_append</a> & <a class=external href=https://github.com/ogobrecht/console/blob/main/docs/package-console.md#procedure-clob_flush_cache rel=external>clob_flush_cache</a>.<p>More can be found in the <a class=external href=https://github.com/ogobrecht/console/blob/main/docs/api-overview.md rel=external>API overview</a>.<h2 id=displaying-the-package-status-of-console-in-a-session>Displaying the package status of Console in a session</h2><p>If you are interested in what is configured in the current session of Console, you can look at it with a pipelined table function or make it available in your application with a report:<pre class="giallo z-code"><code data-lang=sql><span class=giallo-l><span class=z-keyword>select</span><span class="z-keyword z-operator"> *</span><span class=z-keyword> from table</span><span class=z-source>(console.status);</span></span></code></pre><table><thead><tr><th>ATTRIBUTE<th>VALUE<tbody><tr><td>c_version<td>1.0.0<tr><td>localtimestamp<td>2021-10-03 13:58:00<tr><td>sysdate<td>2021-10-03 11:58:00<tr><td>g_conf_check_sysdate<td>2021-10-03 11:58:10<tr><td>g_conf_exit_sysdate<td>2021-10-03 12:58:00<tr><td>g_conf_client_identifier<td>{o,o} 11ECD3500002<tr><td>g_conf_level<td>5<tr><td>level_name(g_conf_level)<td>trace<tr><td>g_conf_check_interval<td>10<tr><td>g_conf_enable_ascii_art<td>true<tr><td>g_conf_call_stack<td>false<tr><td>g_conf_user_env<td>false<tr><td>g_conf_apex_env<td>false<tr><td>g_conf_cgi_env<td>false<tr><td>g_conf_console_env<td>false<tr><td>g_counters.count<td>1<tr><td>g_timers.count<td>2<tr><td>g_saved_stack.count<td>0<tr><td>g_prev_error_msg<td></table><h2 id=apex-error-handling-function>APEX Error Handling Function</h2><p>For APEX, Console comes with a so-called “<a class=external href=https://docs.oracle.com/en/database/oracle/application-express/20.2/aeapi/Example-of-an-Error-Handling-Function.html#GUID-2CD75881-1A59-4787-B04B-9AAEC14E1A82 rel=external>Error Handling Function</a>” which can enter errors within the APEX runtime environment into the log table. If you want to use this, you have to enter this function in your application in the “Application Builder” under “Edit Application Properties > Error Handling > Error Handling Function”: <code>console.apex_error_handling</code>.<figure><img alt="APEX error handling with ASCII art enabled" src=/img/console-apex-error-handling-function.png><figcaption>APEX error handling with ASCII art enabled</figcaption></figure><p>The Error Handling Function logs the technical error in the CONSOLE_LOGS table and writes a friendly message to the end user. It uses the APEX Text Message feature for the user-friendly messages in case of constraint violations, as described in <a class=external href=https://www.insum.ca/episode-22-error-handling/ rel=external>this video</a> by Anton and Neelesh from Insum, which in turn is based on an idea by Roel Hartman in <a class=external href=https://roelhartman.blogspot.com/2021/02/stop-using-validations-for-checking.html rel=external>this blog post</a>. The APEX community rocks….<h2 id=apex-plug-in-for-capturing-frontend-errors>APEX Plug-in for capturing frontend errors</h2><p>Furthermore, there is an APEX Dynamic Action Plug-in, which enters JavaScript errors in the user’s browser via AJAX call into the log table. This way you also get to know if the frontend is not running smoothly for the users…<p>You have to make sure that Console is either installed in the parsing schema of the application or a synonym named CONSOLE has been created in the parsing schema which points to the package CONSOLE. Then you can install the plug-in in <code>install/apex_plugin.sql</code> and create a Dynamic Action for the whole application on page zero:<ul><li>Event: Page Load<li>Action: Oracle Instrumentation Console [Plug-in]<li>No further customization required (only a JavaScript file will be loaded)</ul><p>For those interested in what the plug-in does: <code>sources/apex_plugin_console.js</code>. This is currently a minimal implementation and may be improved in the future.<h2 id=sources-of-inspiration>Sources of inspiration</h2><p>I am not alone in the world and without the others not much goes in software development. Here are a few links to sites or projects that inspired me on the way to my own logging tool:<ul><li><a class=external href=https://developers.google.com/web/tools/chrome-devtools/console/api rel=external>JavaScript Console API</a><li><a class=external href=https://github.com/OraOpenSource/Logger rel=external>Logger</a><li><a class=external href=https://github.com/connormcd/instrumentation rel=external>Instrumentation for PLSQL</a><li><a class=external href=https://github.com/j-sieben/PIT/ rel=external>PIT</a><li><a class=external href=https://blogs.oracle.com/oraclemagazine/post/sophisticated-call-stack-analysis rel=external>Oracle Magazine - Sophisticated Call Stack Analysis</a></ul><p>Special thanks to <a class=external href=https://twitter.com/daust_de rel=external>Dietmar Aust</a>, who gave me time and ideas with a discussion session at an early stage.<h2 id=project-homepage>Project homepage</h2><p>Console is hosted on <a class=external href=https://github.com/ogobrecht/console rel=external>GitHub</a>.<p>Happy logging and debugging :-)<p>Ottmar</section><nav class="full-width article-navigation"><div><a aria-describedby=left_title aria-label=Prev href=https://ogobrecht.com/blog/create-fast-insert-scripts/><span class=arrow>←</span> Prev</a><p aria-hidden=true id=left_title>Create fast insert scripts</div><div><a aria-describedby=right_title aria-label=Next href=https://ogobrecht.com/blog/generate-apex-plug-ins-on-the-command-line/>Next <span class=arrow>→</span></a><p aria-hidden=true id=right_title>Generate APEX plug-ins on the command line</div></nav><div data-repo-id="MDEwOlJlcG9zaXRvcnkzMjEzNzI3MzE=" class=comments data-category=General data-category-id=DIC_kwDOEyfCO84C0uh1 data-dark-theme=noborder_dark data-input-position=bottom data-lang=en data-lazy-loading=true data-light-theme=noborder_light data-mapping=specific data-reactions-enabled=0 data-repo=ogobrecht/ogobrecht.com data-strict=1 data-term=yet-another-oracle-db-logging-tool-console id=comments><script async src=https://ogobrecht.com/js/giscus.min.js></script><noscript>You need JavaScript to view the comments.</noscript></div></article></main><div id=button-container><div id=toc-floating-container><input class=toggle id=toc-toggle type=checkbox><label title="Toggle Table of Contents" class=button for=toc-toggle id=toc-button><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="M414.82-193.094q-18.044 0-30.497-12.32-12.453-12.319-12.453-30.036t12.453-30.086q12.453-12.37 30.497-12.37h392.767q17.237 0 29.927 12.487 12.69 12.486 12.69 30.203 0 17.716-12.69 29.919t-29.927 12.203H414.82Zm0-244.833q-18.044 0-30.497-12.487Q371.87-462.9 371.87-480.45t12.453-29.92q12.453-12.369 30.497-12.369h392.767q17.237 0 29.927 12.511 12.69 12.512 12.69 29.845 0 17.716-12.69 30.086-12.69 12.37-29.927 12.37H414.82Zm0-245.167q-18.044 0-30.497-12.32t-12.453-30.037q0-17.716 12.453-30.086 12.453-12.369 30.497-12.369h392.767q17.237 0 29.927 12.486 12.69 12.487 12.69 30.203 0 17.717-12.69 29.92-12.69 12.203-29.927 12.203H414.82ZM189.379-156.681q-32.652 0-55.878-22.829t-23.226-55.731q0-32.549 23.15-55.647 23.151-23.097 55.95-23.097 32.799 0 55.313 23.484 22.515 23.484 22.515 56.246 0 32.212-22.861 54.893-22.861 22.681-54.963 22.681Zm0-245.167q-32.652 0-55.878-23.134-23.226-23.135-23.226-55.623 0-32.487 23.467-55.517t56.12-23.03q32.102 0 54.721 23.288 22.62 23.288 22.62 55.775 0 32.488-22.861 55.364-22.861 22.877-54.963 22.877Zm-.82-244.833q-32.224 0-55.254-23.288-23.03-23.289-23.03-55.623 0-32.333 23.271-55.364 23.272-23.03 55.495-23.03 32.224 0 55.193 23.288 22.969 23.289 22.969 55.622 0 32.334-23.21 55.364-23.21 23.031-55.434 23.031Z"/></svg></label><div class=toc-content><div class=toc-container><ul><li><a href=https://ogobrecht.com/blog/yet-another-oracle-db-logging-tool-console/#introduction>Introduction</a><li><a href=https://ogobrecht.com/blog/yet-another-oracle-db-logging-tool-console/#a-single-install-script>A single install script</a><li><a href=https://ogobrecht.com/blog/yet-another-oracle-db-logging-tool-console/#production-safe-without-further-configuration>Production safe without further configuration</a><li><a href=https://ogobrecht.com/blog/yet-another-oracle-db-logging-tool-console/#method-names-based-on-javascript-console>Method names based on JavaScript Console</a><li><a href=https://ogobrecht.com/blog/yet-another-oracle-db-logging-tool-console/#reduced-amount-of-log-entries-through-saved-call-stack>Reduced amount of log entries through saved call stack</a><li><a href=https://ogobrecht.com/blog/yet-another-oracle-db-logging-tool-console/#simple-logging-of-method-parameters>Simple logging of method parameters</a><li><a href=https://ogobrecht.com/blog/yet-another-oracle-db-logging-tool-console/#markdown-format-for-automatically-determined-metadata>Markdown format for automatically determined metadata</a><li><a href=https://ogobrecht.com/blog/yet-another-oracle-db-logging-tool-console/#extensible-logs-through-overloaded-log-methods>Extensible logs through overloaded log methods</a><li><a href=https://ogobrecht.com/blog/yet-another-oracle-db-logging-tool-console/#measure-time-and-count-things>Measure time and count things</a><li><a href=https://ogobrecht.com/blog/yet-another-oracle-db-logging-tool-console/#assert-format-and-other-helpers>Assert, format and other helpers</a><li><a href=https://ogobrecht.com/blog/yet-another-oracle-db-logging-tool-console/#displaying-the-package-status-of-console-in-a-session>Displaying the package status of Console in a session</a><li><a href=https://ogobrecht.com/blog/yet-another-oracle-db-logging-tool-console/#apex-error-handling-function>APEX Error Handling Function</a><li><a href=https://ogobrecht.com/blog/yet-another-oracle-db-logging-tool-console/#apex-plug-in-for-capturing-frontend-errors>APEX Plug-in for capturing frontend errors</a><li><a href=https://ogobrecht.com/blog/yet-another-oracle-db-logging-tool-console/#sources-of-inspiration>Sources of inspiration</a><li><a href=https://ogobrecht.com/blog/yet-another-oracle-db-logging-tool-console/#project-homepage>Project homepage</a></ul></div></div></div><a title="Go to the comments section" class=no-hover-padding href=#comments id=comments-button> <svg viewbox="0 0 20 20" fill=currentColor><path d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule=evenodd fill-rule=evenodd /></svg> </a><a title="Go to the top of the page" class=no-hover-padding href=# id=top-button> <svg viewbox="0 0 20 20" fill=currentColor><path d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z"/></svg> </a></div><span class=hidden id=copy-success> Copied! </span><span class=hidden id=copy-init> Copy code to clipboard </span><script defer src=https://ogobrecht.com/js/copyCodeToClipboard.min.js></script></div><footer><section><nav class="socials nav-navs"><ul><li><a class="nav-links no-hover-padding social" href=https://ogobrecht.com/atom.xml> <img alt=feed loading=lazy src=https://ogobrecht.com/social_icons/rss.svg title=feed> </a><li><a class="nav-links no-hover-padding social" rel=" me" href=https://github.com/ogobrecht> <img alt=GitHub loading=lazy src=https://ogobrecht.com/social_icons/github.svg title=GitHub> </a><li><a class="nav-links no-hover-padding social" rel=" me" href=https://bsky.app/profile/ogobrecht.com> <img alt=Bluesky loading=lazy src=https://ogobrecht.com/social_icons/bluesky.svg title=Bluesky> </a><li><a class="nav-links no-hover-padding social" rel=" me" href=https://www.linkedin.com/in/ogobrecht/> <img alt=LinkedIn loading=lazy src=https://ogobrecht.com/social_icons/linkedin.svg title=LinkedIn> </a><li><a class="nav-links no-hover-padding social" rel=" me" href=mailto:ottmar.gobrecht@gmail.com> <img alt=Email loading=lazy src=https://ogobrecht.com/social_icons/email.svg title=Email> </a></ul></nav><nav class=nav-navs><small> <ul><li><a class="nav-links no-hover-padding" href=https://ogobrecht.com/imprint/> imprint </a><li><a class="nav-links no-hover-padding" href=https://ogobrecht.com/privacy/> privacy policy </a><li><a class="nav-links no-hover-padding" href=https://ogobrecht.com/sitemap.xml> sitemap </a></ul> </small></nav><div class=credits><small> Powered by <a href=https://www.getzola.org>Zola</a> & <a href=https://github.com/welpo/tabi>tabi</a> </small></div></section><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><h1 class=visually-hidden id=modalTitle>Search</h1><div id=modal-content><div id=searchBar><div aria-hidden=true class=search-icon><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z"/></svg></div><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search… role=combobox spellcheck=false><div class="close-icon interactive-icon" title="Clear search" id=clear-search role=button tabindex=0><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></div></div><div id=results-container><div id=results-info><span id=zero_results> No results</span><span id=one_results> $NUMBER result</span><span id=many_results> $NUMBER results</span><span id=two_results> $NUMBER results</span><span id=few_results> $NUMBER results</span></div><div id=results role=listbox></div></div></div></div></footer>