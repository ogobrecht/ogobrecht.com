<!doctype html><html lang=en><head><meta charset=UTF-8><meta content="default-src 'self';font-src 'self' data:;img-src 'self' https://* data:;media-src 'self';style-src 'self';frame-src player.vimeo.com https://www.youtube-nocookie.com giscus.app;connect-src 'self';script-src 'self'  giscus.app 'self'" http-equiv=Content-Security-Policy><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://ogobrecht.com name=base><title>
Ottmar’s Notes • How to migrate Oracle Cloud wallet into existing auto_login_local wallet</title><link href=https://ogobrecht.com/img/avatar.png rel=icon type=image/png><link title="Ottmar’s Notes - Atom Feed" href=https://ogobrecht.com/atom.xml rel=alternate type=application/atom+xml><link href="https://ogobrecht.com/custom_subset.css?h=0b9535a28bc3d5bf2321" rel=stylesheet><link href="https://ogobrecht.com/main.css?h=045c365e19a4d50a64bb" rel=stylesheet><meta content="light dark" name=color-scheme><meta content="One secure wallet for all your connections, no need to provide passwords in SQL*Plus, SQLcl and SQL Developer" name=description><meta content="One secure wallet for all your connections, no need to provide passwords in SQL*Plus, SQLcl and SQL Developer" property=og:description><meta content="How to migrate Oracle Cloud wallet into existing auto_login_local wallet" property=og:title><meta content=article property=og:type><meta content=en_GB property=og:locale><meta content=https://ogobrecht.com/blog/how-to-migrate-oracle-cloud-wallet-into-existing-auto-login-local-wallet/ property=og:url><meta content="Ottmar’s Notes" property=og:site_name><noscript><link href=https://ogobrecht.com/no_js.css rel=stylesheet></noscript><script src=https://ogobrecht.com/js/initializeTheme.min.js></script><script defer src=https://ogobrecht.com/js/themeSwitcher.min.js></script><script src="https://ogobrecht.com/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><a href=#main-content id=skip-link>Skip to content</a><header><nav class=navbar><div class=nav-title><a class=home-title href=https://ogobrecht.com/>Ottmar’s Notes</a></div><div class=nav-navs><ul><li><a class="nav-links no-hover-padding" href=https://ogobrecht.com/blog/>blog </a><li><a class="nav-links no-hover-padding" href=https://ogobrecht.com/archive/>archive </a><li><a class="nav-links no-hover-padding" href=https://ogobrecht.com/tags/>tags </a><li><a class="nav-links no-hover-padding" href=https://ogobrecht.com/projects/>projects </a><li class=menu-icons-container><ul class=menu-icons-group><li class="js menu-icon"><div aria-label="Click or press $SHORTCUT to open search" class="search-icon interactive-icon" title="Click or press $SHORTCUT to open search" id=search-button role=button tabindex=0><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z"/></svg></div><li class="theme-switcher-wrapper js"><div aria-label="Toggle dark mode" title="Toggle dark/light mode" aria-pressed=false class=theme-switcher role=button tabindex=0></div><div aria-label="Reset mode to default" class="theme-resetter arrow" title="Reset mode to default" aria-hidden=true role=button tabindex=0></div></ul></ul></div></nav></header><div class=content id=main-content><main><article class=h-entry><h1 class="p-name article-title">How to migrate Oracle Cloud wallet into existing auto_login_local wallet</h1><a class="u-url u-uid" href=https://ogobrecht.com/blog/how-to-migrate-oracle-cloud-wallet-into-existing-auto-login-local-wallet/></a><ul class=meta><span class="hidden p-author h-card"> <a title="Ottmar Gobrecht" class=u-url href=https://ogobrecht.com rel=author>Ottmar Gobrecht</a> </span><li><time class=dt-published datetime=2020-08-03>3rd Aug 2020</time><li title="559 words"><span aria-hidden=true class=separator>•</span>3 min read<li class=tag><span aria-hidden=true class=separator>•</span>Tags: <li class=tag><a class=p-category href=https://ogobrecht.com/tags/oracle/>Oracle</a>, <li class=tag><a class=p-category href=https://ogobrecht.com/tags/wallet/>Wallet</a>, <li class=tag><a class=p-category href=https://ogobrecht.com/tags/script/>Script</a></ul><p class=p-summary hidden>One secure wallet for all your connections, no need to provide passwords in SQL*Plus, SQLcl and SQL Developer<section class="e-content body"><p>I started to store user credentials in wallet files for higher security in SQL scripts. If you do so you should also secure the access to your wallet files on the operating system level. This is especially true for auto-login wallets from the Oracle Cloud. To increase the security a bit further you can restrict the auto-login to the local user who created the wallet. To achieve this you need to create an own wallet with <code>orapki</code> instead of <code>mkstore</code>:<pre class="giallo z-code"><code data-lang=shellscript><span class=giallo-l><span class="z-entity z-name z-function">orapki</span><span class=z-string> wallet create</span><span class="z-constant z-character z-escape"> \</span></span>
<span class=giallo-l><span class="z-string z-punctuation z-definition z-string">  -wallet "path/to/my/wallet"</span><span class="z-constant z-character z-escape"> \</span></span>
<span class=giallo-l><span class=z-string>  -pwd myPassword</span><span class="z-constant z-character z-escape"> \</span></span>
<span class=giallo-l><span class=z-string>  -auto_login_local</span></span></code></pre><p>You can then add new alias/user/password entries with mkstore (you need to add each alias to your tnsnames.ora):<pre class="giallo z-code"><code data-lang=shellscript><span class=giallo-l><span class="z-entity z-name z-function">mkstore</span><span class="z-constant z-character z-escape"> \</span></span>
<span class=giallo-l><span class="z-string z-punctuation z-definition z-string">  -wrl "path/to/my/wallet"</span><span class="z-constant z-character z-escape"> \</span></span>
<span class=giallo-l><span class=z-string>  -createCredential myAlias myUser myPassword</span></span></code></pre><p>If you use only the instant client and cannot find mkstore and orapki, then have a look at my <a href=/blog/how-to-use-mkstore-and-orapki-with-oracle-instant-client/>previous post</a> on how to simulate these tools.<h2 id=the-migration>The Migration</h2><p>I assume you have set an environment variable called TNS_ADMIN pointing to your TNS directory. In this directory, you have your wallet files and also your existing tnsnames.ora and sqlnet.ora to successfully connect to your local Oracle instances.<p>Now you need to extract the downloaded cloud wallet - for security reasons it makes sense to create a temporary subdirectory in your TNS directory and extract the cloud wallet there. You need to migrate the entries from <code>tnsnames.ora</code> and <code>sqlnet.ora</code> into your own TNS files and align the path to your wallet directory. Additionally, you should also copy over the file <code>ojdbc.properties</code> if you do not have it already and you plan to use SQLcl or SQL Developer with your wallet.<p>My resulting sqlnet.ora:<pre class="giallo z-code"><code data-lang=plain><span class=giallo-l><span>WALLET_LOCATION = (SOURCE = (METHOD = file) (METHOD_DATA = (DIRECTORY = "C:\\path\\to\\my\\wallet")))</span></span>
<span class=giallo-l><span>SSL_SERVER_DN_MATCH = yes</span></span>
<span class=giallo-l><span>sqlnet.wallet_override = true</span></span></code></pre><p>My resulting tnsnames.ora:<pre class="giallo z-code"><code data-lang=plain><span class=giallo-l><span>myCloudDbName_high, myAlias = (description = (...</span></span>
<span class=giallo-l><span>myCloudDbName_medium        = (description = (...</span></span>
<span class=giallo-l><span>myCloudDbName_low           = (description = (...</span></span>
<span class=giallo-l><span>myCloudDbName_tp            = (description = (...</span></span>
<span class=giallo-l><span>myCloudDbName_tpurgent      = (description = (...</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span>myLocalDbName, myOtherAlias = (description = (...</span></span>
<span class=giallo-l><span>...</span></span></code></pre><p>That was the easy part, but how you migrate the needed private key and all certificates?<p>It took me some time to figure this out because most people seem to use the cloud wallet as it is. This is understandable since SQL Developer can direct use the zipped version of the wallet. But my target is not to manage the passwords in multiple places - the databases, multiple wallets, SQL Developer and possibly other tools. I want to manage the passwords only in the databases and in one wallet and use this wallet with all the tools - in my case SQL*Plus, SQLcl and SQL Developer.<p>First I tried to export the private key and all certificates from the cloud wallet and then import it into my wallet. I was not successful with this mostly because of the private key and unknown alias names - maybe I was too tired from all the try and error things on how to achieve this. I came finally up with the idea to use the cloud wallet Java KeyStore files and convert them into my wallet with the orapki method <code>jks_to_pkcs12</code>.<p>Migrate private key and certificate from cloud wallet:<pre class="giallo z-code"><code data-lang=shellscript><span class=giallo-l><span class="z-entity z-name z-function">orapki</span><span class=z-string> wallet jks_to_pkcs12</span><span class="z-constant z-character z-escape"> \</span></span>
<span class=giallo-l><span class="z-string z-punctuation z-definition z-string">  -wallet "path/to/my/wallet"</span><span class="z-constant z-character z-escape"> \</span></span>
<span class=giallo-l><span class=z-string>  -pwd myPassword</span><span class="z-constant z-character z-escape"> \</span></span>
<span class=giallo-l><span class="z-string z-punctuation z-definition z-string">  -keystore "path/to/cloud/wallet/keystore.jks"</span><span class="z-constant z-character z-escape"> \</span></span>
<span class=giallo-l><span class=z-string>  -jkspwd myCloudWalletPassword</span></span></code></pre><p>Migrate trusted certificates from cloud wallet:<pre class="giallo z-code"><code data-lang=shellscript><span class=giallo-l><span class="z-entity z-name z-function">orapki</span><span class=z-string> wallet jks_to_pkcs12</span><span class="z-constant z-character z-escape"> \</span></span>
<span class=giallo-l><span class="z-string z-punctuation z-definition z-string">  -wallet "path/to/my/wallet"</span><span class="z-constant z-character z-escape"> \</span></span>
<span class=giallo-l><span class=z-string>  -pwd myPassword</span><span class="z-constant z-character z-escape"> \</span></span>
<span class=giallo-l><span class="z-string z-punctuation z-definition z-string">  -keystore "path/to/cloud/wallet/truststore.jks"</span><span class="z-constant z-character z-escape"> \</span></span>
<span class=giallo-l><span class=z-string>  -jkspwd myCloudWalletPassword</span></span></code></pre><p>Finally, list the wallet content to see the migrated entries:<pre class="giallo z-code"><code data-lang=shellscript><span class=giallo-l><span class="z-entity z-name z-function">orapki</span><span class=z-string> wallet display -wallet . -pwd myPassword</span></span>
<span class=giallo-l><span class="z-punctuation z-definition z-comment z-comment"># or</span></span>
<span class=giallo-l><span class="z-entity z-name z-function">orapki</span><span class=z-string> wallet display -wallet . -pwd myPassword -complete</span></span></code></pre><p>The final file list in my TNS directory (without the Java KeyStore files from the cloud wallet):<pre class="giallo z-code"><code data-lang=shellscript><span class=giallo-l><span class="z-entity z-name z-function">cwallet.sso</span></span>
<span class=giallo-l><span class="z-entity z-name z-function">cwallet.sso.lck</span></span>
<span class=giallo-l><span class="z-entity z-name z-function">ewallet.p12</span></span>
<span class=giallo-l><span class="z-entity z-name z-function">ewallet.p12.lck</span></span>
<span class=giallo-l><span class="z-entity z-name z-function">ojdbc.properties</span></span>
<span class=giallo-l><span class="z-entity z-name z-function">sqlnet.ora</span></span>
<span class=giallo-l><span class="z-entity z-name z-function">tnsnames.ora</span></span></code></pre><p>I am now able to connect to my cloud database with the desired tools without providing user/password details (tested version):<ul><li>SQL*Plus (19.6): <code>sqlplus /@myAlias</code><li>SQLcl (20.2): <code>sql /@myAlias</code><li>SQL Developer (20.2): authentication type “OS”, connection type “Custom JDBC” with URL <code>jdbc:oracle:thin:/@myAlias</code></ul><p>If you forgot which aliases you have configured in your wallet:<pre class="giallo z-code"><code data-lang=shellscript><span class=giallo-l><span class="z-entity z-name z-function">mkstore</span><span class="z-string z-punctuation z-definition z-string"> -wrl "path/to/my/wallet" -listCredential</span></span></code></pre><p>Hope this helps someone else.<p>Happy developing and scripting :-)<p>Ottmar</section><nav class="full-width article-navigation"><div><a aria-describedby=left_title aria-label=Prev href=https://ogobrecht.com/blog/how-to-use-mkstore-and-orapki-with-oracle-instant-client/><span class=arrow>←</span> Prev</a><p aria-hidden=true id=left_title>How to use mkstore and orapki with Oracle Instant Client</div><div><a aria-describedby=right_title aria-label=Next href=https://ogobrecht.com/blog/new-version-of-oracle-table-api-generator-available/>Next <span class=arrow>→</span></a><p aria-hidden=true id=right_title>New Version of Oracle Table API Generator Available</div></nav><div data-repo-id="MDEwOlJlcG9zaXRvcnkzMjEzNzI3MzE=" class=comments data-category=General data-category-id=DIC_kwDOEyfCO84C0uh1 data-dark-theme=noborder_dark data-input-position=bottom data-lang=en data-lazy-loading=true data-light-theme=noborder_light data-mapping=specific data-reactions-enabled=0 data-repo=ogobrecht/ogobrecht.com data-strict=1 data-term=how-to-migrate-oracle-cloud-wallet-into-existing-auto-login-local-wallet id=comments><script async src=https://ogobrecht.com/js/giscus.min.js></script><noscript>You need JavaScript to view the comments.</noscript></div></article></main><div id=button-container><div id=toc-floating-container><input class=toggle id=toc-toggle type=checkbox><label title="Toggle Table of Contents" class=button for=toc-toggle id=toc-button><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="M414.82-193.094q-18.044 0-30.497-12.32-12.453-12.319-12.453-30.036t12.453-30.086q12.453-12.37 30.497-12.37h392.767q17.237 0 29.927 12.487 12.69 12.486 12.69 30.203 0 17.716-12.69 29.919t-29.927 12.203H414.82Zm0-244.833q-18.044 0-30.497-12.487Q371.87-462.9 371.87-480.45t12.453-29.92q12.453-12.369 30.497-12.369h392.767q17.237 0 29.927 12.511 12.69 12.512 12.69 29.845 0 17.716-12.69 30.086-12.69 12.37-29.927 12.37H414.82Zm0-245.167q-18.044 0-30.497-12.32t-12.453-30.037q0-17.716 12.453-30.086 12.453-12.369 30.497-12.369h392.767q17.237 0 29.927 12.486 12.69 12.487 12.69 30.203 0 17.717-12.69 29.92-12.69 12.203-29.927 12.203H414.82ZM189.379-156.681q-32.652 0-55.878-22.829t-23.226-55.731q0-32.549 23.15-55.647 23.151-23.097 55.95-23.097 32.799 0 55.313 23.484 22.515 23.484 22.515 56.246 0 32.212-22.861 54.893-22.861 22.681-54.963 22.681Zm0-245.167q-32.652 0-55.878-23.134-23.226-23.135-23.226-55.623 0-32.487 23.467-55.517t56.12-23.03q32.102 0 54.721 23.288 22.62 23.288 22.62 55.775 0 32.488-22.861 55.364-22.861 22.877-54.963 22.877Zm-.82-244.833q-32.224 0-55.254-23.288-23.03-23.289-23.03-55.623 0-32.333 23.271-55.364 23.272-23.03 55.495-23.03 32.224 0 55.193 23.288 22.969 23.289 22.969 55.622 0 32.334-23.21 55.364-23.21 23.031-55.434 23.031Z"/></svg></label><div class=toc-content><div class=toc-container><ul><li><a href=https://ogobrecht.com/blog/how-to-migrate-oracle-cloud-wallet-into-existing-auto-login-local-wallet/#the-migration>The Migration</a></ul></div></div></div><a title="Go to the comments section" class=no-hover-padding href=#comments id=comments-button> <svg viewbox="0 0 20 20" fill=currentColor><path d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule=evenodd fill-rule=evenodd /></svg> </a><a title="Go to the top of the page" class=no-hover-padding href=# id=top-button> <svg viewbox="0 0 20 20" fill=currentColor><path d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z"/></svg> </a></div><span class=hidden id=copy-success> Copied! </span><span class=hidden id=copy-init> Copy code to clipboard </span><script defer src=https://ogobrecht.com/js/copyCodeToClipboard.min.js></script></div><footer><section><nav class="socials nav-navs"><ul><li><a class="nav-links no-hover-padding social" href=https://ogobrecht.com/atom.xml> <img alt=feed loading=lazy src=https://ogobrecht.com/social_icons/rss.svg title=feed> </a><li><a class="nav-links no-hover-padding social" rel=" me" href=https://github.com/ogobrecht> <img alt=GitHub loading=lazy src=https://ogobrecht.com/social_icons/github.svg title=GitHub> </a><li><a class="nav-links no-hover-padding social" rel=" me" href=https://bsky.app/profile/ogobrecht.com> <img alt=Bluesky loading=lazy src=https://ogobrecht.com/social_icons/bluesky.svg title=Bluesky> </a><li><a class="nav-links no-hover-padding social" rel=" me" href=https://www.linkedin.com/in/ogobrecht/> <img alt=LinkedIn loading=lazy src=https://ogobrecht.com/social_icons/linkedin.svg title=LinkedIn> </a><li><a class="nav-links no-hover-padding social" rel=" me" href=mailto:ottmar.gobrecht@gmail.com> <img alt=Email loading=lazy src=https://ogobrecht.com/social_icons/email.svg title=Email> </a></ul></nav><nav class=nav-navs><small> <ul><li><a class="nav-links no-hover-padding" href=https://ogobrecht.com/imprint/> imprint </a><li><a class="nav-links no-hover-padding" href=https://ogobrecht.com/privacy/> privacy policy </a><li><a class="nav-links no-hover-padding" href=https://ogobrecht.com/sitemap.xml> sitemap </a></ul> </small></nav><div class=credits><small> Powered by <a href=https://www.getzola.org>Zola</a> & <a href=https://github.com/welpo/tabi>tabi</a> </small></div></section><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><h1 class=visually-hidden id=modalTitle>Search</h1><div id=modal-content><div id=searchBar><div aria-hidden=true class=search-icon><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z"/></svg></div><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search… role=combobox spellcheck=false><div class="close-icon interactive-icon" title="Clear search" id=clear-search role=button tabindex=0><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></div></div><div id=results-container><div id=results-info><span id=zero_results> No results</span><span id=one_results> $NUMBER result</span><span id=many_results> $NUMBER results</span><span id=two_results> $NUMBER results</span><span id=few_results> $NUMBER results</span></div><div id=results role=listbox></div></div></div></div></footer>